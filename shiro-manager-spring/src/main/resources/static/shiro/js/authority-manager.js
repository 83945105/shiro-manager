webpackJsonp([0],{"1J5t":function(e,t,r){r("Gquc"),r("IsPG"),r("A1pn"),r("oltR"),r("V7Pz"),r("DG01"),r("toDE"),e.exports=r("AKd3").Set},"27tL":function(e,t,r){var o=r("8Nvm");e.exports=function(e,t){if(!o(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},"4BpY":function(e,t,r){"use strict";var o=r("C02x"),s=r("AKd3"),n=r("lIiZ"),a=r("sjnA"),i=r("biYF")("species");e.exports=function(e){var t="function"==typeof s[e]?s[e]:o[e];a&&t&&!t[i]&&n.f(t,i,{configurable:!0,get:function(){return this}})}},"4HpA":function(e,t,r){"use strict";var o=r("C02x"),s=r("FITv"),n=r("DVkV"),a=r("BRDz"),i=r("bHZz"),l=r("bodH"),c=r("k/7E"),u=r("t8DS"),d=r("8Nvm"),h=r("XAI7"),p=r("lIiZ").f,m=r("A+MN")(0),f=r("sjnA");e.exports=function(e,t,r,v,g,R){var w=o[e],y=w,x=g?"set":"add",b=y&&y.prototype,L={};return f&&"function"==typeof y&&(R||b.forEach&&!a(function(){(new y).entries().next()}))?(y=t(function(t,r){u(t,y,e,"_c"),t._c=new w,void 0!=r&&c(r,g,t[x],t)}),m("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in b&&(!R||"clear"!=e)&&i(y.prototype,e,function(r,o){if(u(this,y,e),!t&&R&&!d(r))return"get"==e&&void 0;var s=this._c[e](0===r?0:r,o);return t?this:s})}),R||p(y.prototype,"size",{get:function(){return this._c.size}})):(y=v.getConstructor(t,e,g,x),l(y.prototype,r),n.NEED=!0),h(y,e),L[e]=y,s(s.G+s.W+s.F,L),R||v.setStrong(y,e,g),y}},"75+0":function(e,t,r){var o=r("biYF")("iterator"),s=!1;try{var n=[7][o]();n.return=function(){s=!0},Array.from(n,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!s)return!1;var r=!1;try{var n=[7],a=n[o]();a.next=function(){return{done:r=!0}},n[o]=function(){return a},e(n)}catch(e){}return r}},"7a4n":function(e,t){e.exports=[{label:"权限管理",routerName:"Manager"}]},"8SsP":function(e,t,r){var o=r("FITv");o(o.P+o.R,"Map",{toJSON:r("Oyrx")("Map")})},"8u2G":function(e,t){},"A+MN":function(e,t,r){var o=r("WwGG"),s=r("mEMm"),n=r("OXaN"),a=r("CFGK"),i=r("dC2g");e.exports=function(e,t){var r=1==e,l=2==e,c=3==e,u=4==e,d=6==e,h=5==e||d,p=t||i;return function(t,i,m){for(var f,v,g=n(t),R=s(g),w=o(i,m,3),y=a(R.length),x=0,b=r?p(t,y):l?p(t,0):void 0;y>x;x++)if((h||x in R)&&(v=w(f=R[x],x,g),e))if(r)b[x]=v;else if(v)switch(e){case 3:return!0;case 5:return f;case 6:return x;case 2:b.push(f)}else if(u)return!1;return d?-1:c||u?u:b}}},BKAK:function(e,t){},DG01:function(e,t,r){r("vyS5")("Set")},DPLo:function(e,t){e.exports=[{label:"用户管理",routerName:"UserManager"},{label:"角色管理",routerName:"RoleManager"},{label:"资源管理",routerName:"ResManager"}]},"G/71":function(e,t,r){r("Gquc"),r("IsPG"),r("A1pn"),r("uhis"),r("8SsP"),r("bJpG"),r("stem"),e.exports=r("AKd3").Map},I0qt:function(e,t){},MxwP:function(e,t,r){"use strict";var o=r("lIiZ").f,s=r("c1o2"),n=r("bodH"),a=r("WwGG"),i=r("t8DS"),l=r("k/7E"),c=r("uH+j"),u=r("z7iO"),d=r("4BpY"),h=r("sjnA"),p=r("DVkV").fastKey,m=r("27tL"),f=h?"_s":"size",v=function(e,t){var r,o=p(t);if("F"!==o)return e._i[o];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,c){var u=e(function(e,o){i(e,u,t,"_i"),e._t=t,e._i=s(null),e._f=void 0,e._l=void 0,e[f]=0,void 0!=o&&l(o,r,e[c],e)});return n(u.prototype,{clear:function(){for(var e=m(this,t),r=e._i,o=e._f;o;o=o.n)o.r=!0,o.p&&(o.p=o.p.n=void 0),delete r[o.i];e._f=e._l=void 0,e[f]=0},delete:function(e){var r=m(this,t),o=v(r,e);if(o){var s=o.n,n=o.p;delete r._i[o.i],o.r=!0,n&&(n.n=s),s&&(s.p=n),r._f==o&&(r._f=s),r._l==o&&(r._l=n),r[f]--}return!!o},forEach:function(e){m(this,t);for(var r,o=a(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(o(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!v(m(this,t),e)}}),h&&o(u.prototype,"size",{get:function(){return m(this,t)[f]}}),u},def:function(e,t,r){var o,s,n=v(e,t);return n?n.v=r:(e._l=n={i:s=p(t,!0),k:t,v:r,p:o=e._l,n:void 0,r:!1},e._f||(e._f=n),o&&(o.n=n),e[f]++,"F"!==s&&(e._i[s]=n)),e},getEntry:v,setStrong:function(e,t,r){c(e,t,function(e,r){this._t=m(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?u(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,u(1))},r?"entries":"values",!r,!0),d(t)}}},Oyrx:function(e,t,r){var o=r("adiS"),s=r("vhYp");e.exports=function(e){return function(){if(o(this)!=e)throw TypeError(e+"#toJSON isn't generic");return s(this)}}},SMmX:function(e,t,r){"use strict";var o=r("FITv"),s=r("7p3N"),n=r("WwGG"),a=r("k/7E");e.exports=function(e){o(o.S,e,{from:function(e){var t,r,o,i,l=arguments[1];return s(this),(t=void 0!==l)&&s(l),void 0==e?new this:(r=[],t?(o=0,i=n(l,arguments[2],2),a(e,!1,function(e){r.push(i(e,o++))})):a(e,!1,r.push,r),new this(r))}})}},V2W7:function(e,t,r){var o=r("ZVlJ"),s=r("biYF")("iterator"),n=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||n[s]===e)}},V7Pz:function(e,t,r){var o=r("FITv");o(o.P+o.R,"Set",{toJSON:r("Oyrx")("Set")})},Wlex:function(e,t){},XE6I:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("MVMM"),s=r("zO6J"),n=r("aA9S"),a=r.n(n),i=r("s/sy"),l=r("5s8w"),c=r("8fC+"),u=r("Zci8");var d={get:{userColumnList:"api-shiro-user/get/userColumnList",userPageList:"api-shiro-user/get/userPageList"},put:{userStatus:"api-shiro-user/put/userStatus/{id}"}};var h={get:{roleList:"api-shiro-role/get/roleList",rolePageList:"api-shiro-role/get/rolePageList",rolesForResource:"api-shiro-role/get/rolesForResource"},post:{newRole:"api-shiro-role/post/newRole",validateRole:"api-shiro-role/post/validateRole"},put:{roleStatus:"api-shiro-role/put/roleStatus/{id}",role:"api-shiro-role/put/role/{id}"},delete:{roleList:"api-shiro-role/delete/roleList"}};var p={post:{grantResourcesToRoles:"api-shiro-role-resource/post/grantResourcesToRoles",unGrantResourcesToRoles:"api-shiro-role-resource/post/unGrantResourcesToRoles",grantResourceToRole:"api-shiro-role-resource/post/grantResourceToRole",unGrantResourceToRole:"api-shiro-role-resource/post/unGrantResourceToRole",grantResourcesInNodeToRole:"api-shiro-role-resource/post/grantResourcesInNodeToRole",unGrantResourcesInNodeToRole:"api-shiro-role-resource/post/unGrantResourcesInNodeToRole",grantAllChildResourcesInNodeToRole:"api-shiro-role-resource/post/grantAllChildResourcesInNodeToRole",unGrantAllChildResourcesInNodeToRole:"api-shiro-role-resource/post/unGrantAllChildResourcesInNodeToRole"},get:{roleResourceListByRoleId:"api-shiro-role-resource/get/roleResourceListByRoleId",roleResourceListByResourceId:"api-shiro-role-resource/get/roleResourceListByResourceId"}};var m={get:{roleUserListByUserId:"api-shiro-role-user/get/roleUserListByUserId/{userId}",roleUserListByRoleId:"api-shiro-role-user/get/roleUserListByRoleId/{roleId}"},post:{grantRolesToUsers:"api-shiro-role-user/post/grantRolesToUsers",unGrantRolesToUsers:"api-shiro-role-user/post/unGrantRolesToUsers",grantRoleToUser:"api-shiro-role-user/post/grantRoleToUser",unGrantRoleToUser:"api-shiro-role-user/post/unGrantRoleToUser"}},f=(r("qkBV"),r("K+Rl"),r("aZ1k"),r("0Eag"),r("o+a0")),v=r.n(f),g=(r("Y8I5"),r("fD5l")),R=r.n(g),w=(r("jqXw"),r("2rb8")),y=r.n(w),x=r("HVJf"),b=r("FvRi");
/*!
 * Title: 状态管理
 * Description:
 * author: 白超
 * date: 2017/12/20
 * version: v1.0
 */
o.default.use(x.a);var L=new x.a.Store({modules:{userModule:b.a}}),C=r("GTdf");window.projectConf=r("saw0");var I=r("HBrH");window.events=new I,window.events.setMaxListeners(100),a()(window,{ManagerUrl:l.a,ModuleManagerUrl:c.a,RoleManagerUrl:h,ResourceManagerUrl:u.a,UserManagerUrl:d,RoleResourceManagerUrl:p,RoleUserManagerUrl:m}),o.default.use(v.a),o.default.use(R.a);var k=new w.Message.WeView;o.default.use(y.a,{Ajax:{options:{baseURL:r("qk+/").getBaseUrl(),withCredentials:!0,dataParserOptions:{use:w.DataParser.DataView,options:{needLoginOptions:{callback:function(e,t){window.events.emit("showLoginWindow")}},noAuthorityOptions:{callback:function(e,t){k.open(e.resultInfo.message)}},notFoundOptions:{callback:function(e,t){k.open(e.resultInfo.message)}}}}}},Loading:{alias:["$Loading"]}});var T={name:"layout",components:{LoginWindow:i.a},store:L,mixins:[C.a],data:function(){return{loginWindowModel:!1}},created:function(){var e=this;window.events.on("showLoginWindow",function(){return e.loginWindowModel=!0}),this.getCurrentCertificate(),window.addEventListener("keyup",function(e){if("F2"===e.code)return window.events.emit("clickF2",e),!1})}},_={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("router-view"),e._v(" "),r("login-window",{model:{value:e.loginWindowModel,callback:function(t){e.loginWindowModel=t},expression:"loginWindowModel"}})],1)},staticRenderFns:[]},S=r("vSla")(T,_,!1,null,null,null).exports,N=r("4YfN"),E=r.n(N),U=r("FTBU"),M=r("7a4n"),$=r.n(M),P=r("DPLo"),z=r.n(P),A=r("Fm0B"),K=r("wwgf"),F=r("tov0"),G=r("cI7i"),j={components:{MerlinTabItem:r("J0gf").a,MerlinTabPanel:G.a,MerlinHeaderItem:F.a,MerlinHeaderMenu:K.a,MerlinLeftItem:A.a,MerlinLeftMenu:U.a},name:"manager",mixins:[C.a],data:function(){return{module:{serviceName:"获取中..."},fullScreen:!1,HeaderJson:$.a,LeftJson:z.a}},props:{moduleId:{type:String,required:!0}},computed:E()({},Object(x.b)(["userModule"])),methods:{getModule:function(){var e=this;this.$ajax.get(ModuleManagerUrl.get.module,[this.moduleId]).success(!0,function(t){e.module=t.record})},handleClickHeaderItem:function(e){this.$router.push({name:e.routerName})},handleClickLeftItem:function(e){this.$router.push({name:e.routerName})}},created:function(){this.getModule()}},D={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("merlin-left-menu",{model:{value:e.fullScreen,callback:function(t){e.fullScreen=t},expression:"fullScreen"}},[o("template",{slot:"title"},[o("div",{staticClass:"avalon-merlin-default-system"},[o("img",{staticClass:"avalon-merlin-default-logo avalon-merlin-circle",attrs:{src:r("Z2Ou")}}),e._v(" "),o("div",{staticClass:"avalon-merlin-default-sysname"},[o("h3",[e._v(e._s(e.module.serviceName))]),e._v(" "),o("div",[e._v("权限管理")])])])]),e._v(" "),e._l(e.LeftJson,function(t,r){return[o("merlin-left-item",{key:r,attrs:{label:t.label,"indent-count":1,value:e.$route.name==t.routerName},on:{click:function(r){e.handleClickLeftItem(t)}}})]}),e._v(" "),o("template",{slot:"right"},[o("merlin-header-menu",{on:{click:function(t){e.fullScreen=!e.fullScreen}}},[e._l(e.HeaderJson,function(t,r){return[o("merlin-header-item",{key:r,attrs:{label:t.label,value:e.$route.name.indexOf(t.routerName)>0},on:{click:function(r){e.handleClickHeaderItem(t)}}})]}),e._v(" "),o("template",{slot:"right"},[!1===e.userModule.isLogin?o("div",{staticClass:"avalon-merlin-default-userinfo"},[o("h3",{staticClass:"avalon-merlin-default-username avalon-merlin-ellipsis",on:{click:function(t){return t.stopPropagation(),e.handleShowLoginWindow(t)}}},[e._v("登录")])]):o("div",{staticClass:"avalon-merlin-default-userinfo"},[o("img",{staticClass:"avalon-merlin-default-face avalon-merlin-circle",attrs:{src:r("3DOL")}}),e._v(" "),o("h3",{staticClass:"avalon-merlin-default-username avalon-merlin-ellipsis"},[e._v("您好，"+e._s(e.userModule.username))])]),e._v(" "),!0===e.userModule.isLogin?o("ul",{staticClass:"avalon-merlin-default-sys-function"},[o("li",{on:{click:function(t){return t.stopPropagation(),e.logout(t)}}},[o("i",{staticClass:"merlin merlinfont merlin-tuichu"})])]):e._e()])],2),e._v(" "),o("router-view")],1)],2)},staticRenderFns:[]};var q=r("vSla")(j,D,!1,function(e){r("8u2G")},"data-v-248c75c6",null).exports,H=r("kfHR"),O=r.n(H),B=r("zsLt"),W=r.n(B),V=r("HzJ8"),J=r.n(V),X=r("XQXf"),Y={currentPage:1,pageCount:1,pageSize:10,total:0},Q={name:"user-manager",mixins:[X.a],props:{moduleId:{type:String,required:!0}},data:function(){return{userColumnList:[],searchUser:{searchText:""},tableLoading:!1,userList:[],limit:a()({},Y),roleList:[],checkedUserList:[]}},computed:{usableRoleList:function(){var e=[];for(var t in this.roleList)this.roleList[t].status===this.dict.status.normal&&e.push(this.roleList[t]);return e},unusableRoleList:function(){var e=[];for(var t in this.roleList)this.roleList[t].status===this.dict.status.disabled&&e.push(this.roleList[t]);return e},usableRoleIds:function(){var e=[];for(var t in this.roleList)this.roleList[t].status===this.dict.status.normal&&e.push(this.roleList[t].id);return e}},methods:{getUserColumnList:function(){var e=this;this.$ajax.get(UserManagerUrl.get.userColumnList).success(!0,function(t){e.userColumnList=t.rows,e.getUserPageList()})},userListProcess:function(e){for(var t in e){for(var r in e[t])e[t][r+"-edit"]=!1,e[t][r+"-loading"]=!1,e[t][r+"-edit-value"]=e[t][r];e[t].ownerRoleIds=[],e[t].indeterminateRoles=!1,e[t].checkAllRoles=!1}return e},getRoleList:function(){var e=this;this.$ajax.get(RoleManagerUrl.get.roleList,{moduleId:this.moduleId}).success(!0,function(t){e.roleList=t.rows})},reGetUserPageList:function(){a()(this.limit,Y),this.getUserPageList()},getUserPageList:function(){var e=this;this.tableLoading=!0,this.$ajax.get(UserManagerUrl.get.userPageList,{moduleId:this.moduleId,currentPage:this.limit.currentPage,pageSize:this.limit.pageSize,searchText:this.searchUser.searchText}).success(!0,function(t){a()(e.limit,t.limit),e.userList=e.userListProcess(t.rows)}).finally(function(){return e.tableLoading=!1})},handleExpandChange:function(e,t){var r=this;e.ownerRoleIds.length>0||this.$ajax.get(m.get.roleUserListByUserId,[e.id],{params:{moduleId:this.moduleId}}).success(!0,function(t){e.ownerRoleIds=t.rows.map(function(t){e["role_"+t.roleId+"_status"]=r.dict.status.normal;var o=!0,s=!1,n=void 0;try{for(var a,i=J()(r.roleList);!(o=(a=i.next()).done);o=!0){a.value.id===t.roleId&&(e["role_"+t.roleId+"_status"]="OTHER"===t.type?r.dict.status.disabled:r.dict.status.normal)}}catch(e){s=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(s)throw n}}return t.roleId}),e.ownerRoleIds.length>0&&(e.indeterminateRoles=!0);var o=void 0,s=!0,n=!1,a=void 0;try{for(var i,l=J()(r.usableRoleIds);!(s=(i=l.next()).done);s=!0){var c=i.value;o=!1;var u=!0,d=!1,h=void 0;try{for(var p,m=J()(e.ownerRoleIds);!(u=(p=m.next()).done);u=!0){if(c===p.value){o=!0;break}}}catch(e){d=!0,h=e}finally{try{!u&&m.return&&m.return()}finally{if(d)throw h}}if(!o)return}}catch(e){n=!0,a=e}finally{try{!s&&l.return&&l.return()}finally{if(n)throw a}}e.checkAllRoles=!0})},handleSelectionChange:function(e){this.checkedUserList=e},handleSizeChange:function(e){this.limit.pageSize=e,this.getUserPageList()},handleCurrentChange:function(e){this.limit.currentPage=e,this.getUserPageList()},handleChangeUserStatus:function(e){var t=this;this.$ajax.put(UserManagerUrl.put.userStatus,e,{params:{moduleId:this.moduleId}}).success({message:"切换状态成功"}).notSuccess(function(){e.status===t.dict.status.normal?e.status=t.dict.status.disabled:e.status=t.dict.status.normal})},handleCheckAllRoles:function(e,t){var r=this,o=[],s=new W.a;if(e){var n=!0,a=!1,i=void 0;try{for(var l,c=J()(this.usableRoleList);!(n=(l=c.next()).done);n=!0){var u=l.value;s.add(u.id),t["role_"+u.id+"_status"]!==this.dict.status.disabled&&o.push(u.id)}}catch(e){a=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw i}}this.$ajax.post(m.post.grantRolesToUsers,{userIds:[t.id].toString(),roleIds:o.toString(),moduleId:this.moduleId}).success("设置角色成功",function(){var e=!0,o=!1,n=void 0;try{for(var a,i=J()(t.ownerRoleIds);!(e=(a=i.next()).done);e=!0){var l=a.value;s.add(l)}}catch(e){o=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(o)throw n}}var c=!0,u=!1,d=void 0;try{for(var h,p=J()(r.usableRoleList);!(c=(h=p.next()).done);c=!0){var m=h.value;s.add(m.id)}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}t.ownerRoleIds=O()(s),t.indeterminateRoles=!1})}else this.$ajax.post(m.post.unGrantRolesToUsers,{userIds:[t.id].toString(),roleIds:o.toString(),moduleId:this.moduleId}).success("取消角色成功",function(){var e=new W.a,o=!0,s=!1,n=void 0;try{for(var a,i=J()(t.ownerRoleIds);!(o=(a=i.next()).done);o=!0){var l=a.value,c=!0,u=!1,d=void 0;try{for(var h,p=J()(r.unusableRoleList);!(c=(h=p.next()).done);c=!0){if(h.value.id===l){e.add(l);break}}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}t["role_"+l+"_status"]===r.dict.status.disabled&&e.add(l)}}catch(e){s=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(s)throw n}}t.ownerRoleIds=O()(e),t.indeterminateRoles=t.ownerRoleIds.length>0})},handleCheckRoleChange:function(e,t,r){e?this.$ajax.post(m.post.grantRoleToUser,{userId:t.id,roleId:r.id,moduleId:this.moduleId}).success("设置角色成功"):this.$ajax.post(m.post.unGrantRoleToUser,{userId:t.id,roleId:r.id,moduleId:this.moduleId}).success("取消角色成功")}},created:function(){this.getUserColumnList(),this.getRoleList()}},Z={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"avalon-merlin-default-search-bar avalon-merlin-a-scroll"},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("span",{staticClass:"btn-p-left"},[r("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",size:"small",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchUser.searchText,callback:function(t){e.$set(e.searchUser,"searchText",t)},expression:"searchUser.searchText"}})],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small"},on:{click:e.reGetUserPageList}},[e._v("搜索")])],1)])]),e._v(" "),r("div",[r("div",{staticClass:"list-tools avalon-merlin-hidden"},[r("div",{staticClass:"avalon-merlin-lfloat",staticStyle:{"margin-top":"4px"}},[r("el-tag",{attrs:{size:"small"}},[e._v("点击鼠标右键开启快捷菜单")])],1)]),e._v(" "),r("div",{staticClass:"avalon-merlin-default-list"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{overflow:"inherit"},attrs:{data:e.userList,stripe:"",border:"",height:"100%"},on:{"expand-change":e.handleExpandChange,"selection-change":e.handleSelectionChange}},[e.roleList&&e.roleList.length>0?r("el-table-column",{attrs:{type:"expand",label:"拥有角色列表",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-checkbox",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},attrs:{indeterminate:t.row.indeterminateRoles},on:{change:function(r){e.handleCheckAllRoles(r,t.row)}},model:{value:t.row.checkAllRoles,callback:function(r){e.$set(t.row,"checkAllRoles",r)},expression:"scope.row.checkAllRoles"}},[e._v("全选\n            ")]),e._v(" "),r("el-tag",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},attrs:{size:"small"}},[e._v("点击按钮可以给该当前行用户授予或取消角色")]),e._v(" "),r("el-tag",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},attrs:{size:"small"}},[e._v("绿色背景的角色来源于其它服务")]),e._v(" "),r("el-tag",{attrs:{size:"small"}},[e._v("若该用户在其它服务拥有某个角色,则无法取消")]),e._v(" "),r("el-checkbox-group",{attrs:{size:"small"},model:{value:t.row.ownerRoleIds,callback:function(r){e.$set(t.row,"ownerRoleIds",r)},expression:"scope.row.ownerRoleIds"}},[e._l(e.roleList,function(o){return[r("el-checkbox",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},style:{backgroundColor:o.type===e.dict.roleType.local?void 0:"#67c23a66"},attrs:{label:o.id,title:o.role,disabled:o.status===e.dict.status.disabled||t.row["role_"+o.id+"_status"]===e.dict.status.disabled,border:""},on:{change:function(r){e.handleCheckRoleChange(r,t.row,o)}}},[e._v(e._s(o.name)+"\n                ")])]})],2)]}}])}):e._e(),e._v(" "),e._l(e.userColumnList,function(e,t){return[r("el-table-column",{attrs:{label:e.label,"column-key":e.columnKey,prop:e.columnKey,"min-width":35,align:e.align}})]}),e._v(" "),r("el-table-column",{attrs:{label:"状态","min-width":15,align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{"active-text":"禁用","inactive-text":"取消","active-value":e.dict.status.disabled,"inactive-value":e.dict.status.normal,"active-color":"#f34444"},on:{change:function(r){e.handleChangeUserStatus(t.row)}},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}})]}}])})],2)],1)]),e._v(" "),r("div",{staticClass:"avalon-merlin-default-list-page"},[r("el-pagination",{attrs:{"current-page":e.limit.currentPage,"page-sizes":[10,50,100,200,300,400],"page-size":e.limit.pageSize,total:e.limit.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},staticRenderFns:[]};var ee=r("vSla")(Q,Z,!1,function(e){r("Wlex")},"data-v-3c6f9c1f",null).exports,te=r("cUn4"),re=r.n(te),oe={currentPage:1,pageCount:1,pageSize:10,total:0},se={name:"role-user-manager",mixins:[X.a],data:function(){return{tableHeight:0,userColumnList:[],searchUser:{searchText:""},tableLoading:!1,userList:[],limit:a()({},oe),checkedUserList:[],roleUserList:[]}},props:{moduleId:{type:String,required:!0},roleId:{type:String,required:!0},role:{type:String,required:!0},roleName:{type:String,required:!0}},computed:{hasUserIdsMap:function(){var e=new re.a,t=!0,r=!1,o=void 0;try{for(var s,n=J()(this.roleUserList);!(t=(s=n.next()).done);t=!0){var a=s.value;e.set(a.userId,!0)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}return e},disabledUserIdsMap:function(){var e=new re.a,t=!0,r=!1,o=void 0;try{for(var s,n=J()(this.roleUserList);!(t=(s=n.next()).done);t=!0){var a=s.value;"OTHER"===a.type&&e.set(a.userId,!0)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}return e}},methods:{getUserColumnList:function(){var e=this;this.$ajax.get(UserManagerUrl.get.userColumnList).success(!0,function(t){e.userColumnList=t.rows,e.getUserPageList()})},reGetUserPageList:function(){a()(this.limit,oe),this.getUserPageList()},userListProcess:function(e){var t=this.hasUserIdsMap,r=this.disabledUserIdsMap;for(var o in e)e[o].checked=!!t.get(e[o].id),e[o].disabled=!!r.get(e[o].id);return e},getUserPageList:function(){var e=this;this.tableLoading=!0,this.$ajax.get(UserManagerUrl.get.userPageList,{moduleId:this.moduleId,currentPage:this.limit.currentPage,pageSize:this.limit.pageSize,searchText:this.searchUser.searchText}).success(!0,function(t){a()(e.limit,t.limit),e.userList=e.userListProcess(t.rows)}).finally(function(){return e.tableLoading=!1})},handleSelectionChange:function(e){this.checkedUserList=e},handleSizeChange:function(e){this.limit.pageSize=e,this.getUserPageList()},handleCurrentChange:function(e){this.limit.currentPage=e,this.getUserPageList()},getRoleUserListByRoleId:function(){var e=this;this.$ajax.get(RoleUserManagerUrl.get.roleUserListByRoleId,[this.roleId],{params:{moduleId:this.moduleId}}).success(!0,function(t){e.roleUserList=t.rows,e.getUserColumnList()})},handleChangeUserRoleCheck:function(e,t){t?this.$ajax.post(RoleUserManagerUrl.post.grantRoleToUser,{moduleId:this.moduleId,roleId:this.roleId,userId:e.id}).success("授予角色成功").notSuccess(function(){return e.checked=!t}):this.$ajax.post(RoleUserManagerUrl.post.unGrantRoleToUser,{moduleId:this.moduleId,roleId:this.roleId,userId:e.id}).success("取消角色成功").notSuccess(function(){return e.checked=!t})}},created:function(){this.getRoleUserListByRoleId()},mounted:function(){this.tableHeight=document.body.clientHeight-265}},ne={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"avalon-merlin-default-search-bar full avalon-merlin-a-scroll"},[r("span",{staticClass:"btn-p-left"},[r("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",size:"small",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchUser.searchText,callback:function(t){e.$set(e.searchUser,"searchText",t)},expression:"searchUser.searchText"}})],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small"},on:{click:e.reGetUserPageList}},[e._v("搜索")])],1),e._v(" "),r("div",{staticClass:"avalon-merlin-clra"})]),e._v(" "),r("div",{staticClass:"list-tools avalon-merlin-hidden",staticStyle:{"margin-top":"15px"}},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("el-tag",{attrs:{size:"small"}},[e._v("点击鼠标右键开启快捷菜单")]),e._v(" "),r("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{size:"small"}},[e._v("若该用户在其它服务拥有该角色,则无法取消")])],1)]),e._v(" "),r("div",[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}]},[r("el-table",{style:{height:e.tableHeight+"px"},attrs:{data:e.userList,stripe:"",border:""},on:{"selection-change":e.handleSelectionChange}},[e._l(e.userColumnList,function(e,t){return[r("el-table-column",{attrs:{label:e.label,"column-key":e.columnKey,prop:e.columnKey,"min-width":e.minWidth,align:e.align}})]}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"200",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{"active-text":"授予","inactive-text":"取消","active-color":"#f34444",disabled:t.row.disabled},on:{change:function(r){e.handleChangeUserRoleCheck(t.row,r)}},model:{value:t.row.checked,callback:function(r){e.$set(t.row,"checked",r)},expression:"scope.row.checked"}})]}}])})],2)],1)]),e._v(" "),r("div",{staticClass:"avalon-merlin-default-list-paging"},[r("el-pagination",{attrs:{"current-page":e.limit.currentPage,"page-sizes":[10,50,100,200,300,400],"page-size":e.limit.pageSize,total:e.limit.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},staticRenderFns:[]};var ae=r("vSla")(se,ne,!1,function(e){r("uLBH")},"data-v-4d5bc4c2",null).exports,ie=X.a.data(),le={currentPage:1,pageCount:1,pageSize:10,total:0},ce={name:"role-resource-manager",mixins:[X.a],data:function(){return{tableHeight:0,roleResourceList:[],searchType:ie.dict.searchTypes[0].value,searchResourceTreeLoading:!1,searchResourceTree:{searchTreeText:""},searchLocationResource:"",searchLocationExpandIds:[],searchResourceTreeList:[],resourceList:[],limit:a()({},le),searchResource:{searchText:""},searchResourceTreeModel:!1}},props:{moduleId:{type:String,required:!0},roleId:{type:String,required:!0},role:{type:String,required:!0},roleName:{type:String,required:!0}},computed:{treeTopNum:function(){return this.searchResourceTreeList.length>0?113:62},searchResourceTreeRootIds:function(){var e=[],t=!0,r=!1,o=void 0;try{for(var s,n=J()(this.searchResourceTreeList);!(t=(s=n.next()).done);t=!0){var a=s.value;e.push(a.id)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}return e},hasResourceIdsMap:function(){var e=new re.a,t=!0,r=!1,o=void 0;try{for(var s,n=J()(this.roleResourceList);!(t=(s=n.next()).done);t=!0){var a=s.value;e.set(a.resId,!0)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}return e}},methods:{getRoleResourceListByRoleId:function(){var e=this;this.$ajax.get(RoleResourceManagerUrl.get.roleResourceListByRoleId,{moduleId:this.moduleId,roleId:this.roleId}).success(!0,function(t){e.roleResourceList=t.rows})},searchResourceTreeListProcess:function(e){var t=this,r=[],o=this.hasResourceIdsMap;return e.forEach(function(e){e.children=e.children?e.children:[],e.leaf=!e.childCount||0===e.childCount.length,e.disabled=!e.status||e.status===t.dict.status.disabled||"NODE"!==e.type,e.checked=!!o.get(e.id),e.grantNodeChildLoading=!1,e.unGrantNodeChildLoading=!1,e.grantNodeAllChildLoading=!1,e.unGrantNodeAllChildLoading=!1,r.push(e)}),r},formatterResourceType:function(e,t,r,o){for(var s in this.dict.resourceTypes)if(this.dict.resourceTypes[s].value===r)return this.dict.resourceTypes[s].text;return"未知"},handleSizeChange:function(e){this.limit.pageSize=e,this.getResourcePageList()},handleCurrentChange:function(e){this.limit.currentPage=e,this.getResourcePageList()},getSearchResourceTreeList:function(){var e=this;this.searchResourceTreeLoading=!0,this.$ajax.get(ResourceManagerUrl.get.rootResourceList,{moduleId:this.moduleId,searchText:this.searchResourceTree.searchTreeText}).success(!0,function(t){e.searchResourceTreeList=e.searchResourceTreeListProcess(t.rows)}).finally(function(){return e.searchResourceTreeLoading=!1})},handleLocationSearchResourceTree:function(e,t){e?this.$ajax.get(ResourceManagerUrl.get.locationResourceList,{moduleId:this.moduleId,rootIds:this.searchResourceTreeRootIds.toString(),searchText:e}).success(!0,function(e){t(e.rows)}):t([])},handleSelectLocationSearchResource:function(e){this.searchLocationExpandIds=e.parentIds.substring(1).split("/"),this.expandSearchResourceNode()},expandSearchResourceNode:function(){var e=this.$refs.searchResourceTree.getNode(this.searchLocationExpandIds[0]);e&&(this.searchLocationExpandIds=this.searchLocationExpandIds.slice(1),!1===e.expanded?(e.expand(),this.expandSearchResourceNode()):this.expandSearchResourceNode())},getSearchResourceTreeChildNodeList:function(e,t){var r=this;this.$ajax.get(ResourceManagerUrl.get.childResourceList,{moduleId:this.moduleId,parentId:e.data.id}).success(!0,function(o){var s=r.searchResourceTreeListProcess(o.rows);if(e.data.children=s,e.data.childCount=s.length,e.data.open=!0,t(s),r.searchLocationExpandIds&&r.searchLocationExpandIds.length>0){var n=r.$refs.searchResourceTree.getNode(r.searchLocationExpandIds[0]);r.searchLocationExpandIds=r.searchLocationExpandIds.slice(1),n&&!1===n.expanded&&n.expand()}if(r.newLocationExpandIds&&r.newLocationExpandIds.length>0){var a=r.$refs.newResourceTree.getNode(r.newLocationExpandIds[0]);r.newLocationExpandIds=r.newLocationExpandIds.slice(1),a&&!1===a.expanded&&a.expand()}})},handleCheckedSearchResourceTreeNode:function(e,t,r){var o=this;r?this.$ajax.post(RoleResourceManagerUrl.post.grantResourceToRole,{moduleId:this.moduleId,roleId:this.roleId,resourceId:t.id}).success(!0,function(){t.checked=!0,o.hasResourceIdsMap.set(t.id,!0)}):this.$ajax.post(RoleResourceManagerUrl.post.unGrantResourceToRole,{moduleId:this.moduleId,roleId:this.roleId,resourceId:t.id}).success(!0,function(){t.checked=!1,o.hasResourceIdsMap.delete(t.id)})},handleDblClickTreeNode:function(e,t){t.childCount>0&&(e.expanded?e.collapse():e.expand())},handleClickGrantResourcesInNodeToRole:function(e,t){var r=this;t.grantNodeChildLoading=!0,this.$ajax.post(RoleResourceManagerUrl.post.grantResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&t.children.forEach(function(e){return e.checked=!0}),e.rows.forEach(function(e){r.hasResourceIdsMap.set(e,!0)})}).finally(function(){return t.grantNodeChildLoading=!1})},handleClickUnGrantResourcesInNodeToRole:function(e,t){var r=this;t.unGrantNodeChildLoading=!0,this.$ajax.post(RoleResourceManagerUrl.post.unGrantResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&t.children.forEach(function(e){return e.checked=!1}),e.rows.forEach(function(e){r.hasResourceIdsMap.delete(e)})}).finally(function(){return t.unGrantNodeChildLoading=!1})},checkedChildNode:function(e){var t=!0,r=!1,o=void 0;try{for(var s,n=J()(e);!(t=(s=n.next()).done);t=!0){var a=s.value;a.checked=!0,a.children&&this.checkedChildNode(a.children)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}},handleClickGrantAllChildResourcesInNode:function(e,t){var r=this;t.grantNodeAllChildLoading=!0,this.$ajax.post(RoleResourceManagerUrl.post.grantAllChildResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&r.checkedChildNode(t.children),e.rows.forEach(function(e){r.hasResourceIdsMap.set(e,!0)})}).finally(function(){return t.grantNodeAllChildLoading=!1})},unCheckedChildNode:function(e){var t=!0,r=!1,o=void 0;try{for(var s,n=J()(e);!(t=(s=n.next()).done);t=!0){var a=s.value;a.checked=!1,a.children&&this.unCheckedChildNode(a.children)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}},handleClickUnGrantAllChildResourcesInNode:function(e,t){var r=this;t.unGrantNodeAllChildLoading=!0,this.$ajax.post(RoleResourceManagerUrl.post.unGrantAllChildResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&r.unCheckedChildNode(t.children),e.rows.forEach(function(e){r.hasResourceIdsMap.delete(e)})}).finally(function(){return t.unGrantNodeAllChildLoading=!1})}},created:function(){this.getRoleResourceListByRoleId()},mounted:function(){this.tableHeight=document.body.clientHeight-220}},ue={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"avalon-merlin-default-search-bar full avalon-merlin-a-scroll"},[r("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",clearable:"",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchResourceTree.searchTreeText,callback:function(t){e.$set(e.searchResourceTree,"searchTreeText",t)},expression:"searchResourceTree.searchTreeText"}}),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small",loading:e.searchResourceTreeLoading},on:{click:e.getSearchResourceTreeList}},[e._v("根节点搜索")])],1)],1),e._v(" "),r("div",{staticStyle:{"margin-top":"15px"},style:{height:e.tableHeight+"px"}},[e.searchResourceTreeList.length>0?r("div",{staticClass:"list-tools avalon-merlin-hidden"},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("el-tag",{attrs:{size:"small"}},[e._v("双击节点名称可以展开/收缩节点")])],1),e._v(" "),r("div",{staticClass:"avalon-merlin-lfloat",staticStyle:{"margin-left":"10px"}},[r("el-tag",{attrs:{size:"small"}},[e._v("点击鼠标右键开启快捷菜单(未实现)")])],1),e._v(" "),r("div",{staticClass:"avalon-merlin-lfloat",staticStyle:{"margin-left":"10px"}},[r("el-tag",{attrs:{size:"small"}},[e._v("勾选复选框启用资源")])],1)]):e._e(),e._v(" "),r("div",{staticClass:"tree-module",style:{top:e.treeTopNum+"px"}},[r("el-autocomplete",{directives:[{name:"show",rawName:"v-show",value:e.searchResourceTreeList.length>0,expression:"searchResourceTreeList.length > 0"}],staticStyle:{width:"40%"},attrs:{size:"small",placeholder:"资源定位",debounce:1e3,"value-key":"locationName","fetch-suggestions":e.handleLocationSearchResourceTree,"prefix-icon":"el-icon-search"},on:{select:e.handleSelectLocationSearchResource},model:{value:e.searchLocationResource,callback:function(t){e.searchLocationResource=t},expression:"searchLocationResource"}}),e._v(" "),r("div",{staticClass:"tree-module-inner avalon-merlin-v-scroll"},[r("el-tree",{ref:"searchResourceTree",attrs:{data:e.searchResourceTreeList,"highlight-current":!0,draggable:!0,"check-strictly":!0,lazy:"","expand-on-click-node":!1,props:{label:"name",isLeaf:"leaf"},load:e.getSearchResourceTreeChildNodeList,"node-key":"id","empty-text":"暂无资源"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,s=t.data;return r("span",{staticClass:"custom-tree-node"},[r("span",["NODE"!==s.type?r("el-checkbox",{attrs:{value:s.checked},on:{change:function(t){e.handleCheckedSearchResourceTreeNode(o,s,t)}}}):e._e(),e._v(" "),r("i",{staticClass:"we-icon-save"}),e._v(" "),r("em",{on:{dblclick:function(t){e.handleDblClickTreeNode(o,s)}}},[e._v(e._s(o.label))])],1),e._v(" "),"NODE"===s.type&&s.childCount>0?r("span",[r("el-button",{staticStyle:{color:"#409eff"},attrs:{loading:s.grantNodeChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickGrantResourcesInNodeToRole(o,s)}}},[e._v("使用该节点下所有资源")]),e._v(" "),r("em",[e._v("/")]),e._v(" "),r("el-button",{staticStyle:{color:"#409eff"},attrs:{loading:s.unGrantNodeChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickUnGrantResourcesInNodeToRole(o,s)}}},[e._v("取消该节点下所有资源")]),e._v(" "),r("em",[e._v("    ")]),e._v(" "),r("el-button",{staticStyle:{color:"#f56c6c"},attrs:{loading:s.grantNodeAllChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickGrantAllChildResourcesInNode(o,s)}}},[e._v("使用该节点及所有子节点下所有资源")]),e._v(" "),r("em",[e._v("/")]),e._v(" "),r("el-button",{staticStyle:{color:"#f56c6c"},attrs:{loading:s.unGrantNodeAllChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickUnGrantAllChildResourcesInNode(o,s)}}},[e._v("取消该节点及所有子节点下所有资源")])],1):e._e()])}}])})],1)],1)])])},staticRenderFns:[]};var de=r("vSla")(ce,ue,!1,function(e){r("I0qt")},"data-v-0598a820",null).exports,he=X.a.data(),pe={currentPage:1,pageCount:1,pageSize:10,total:0},me={id:"",name:"",role:"",description:"",parentId:"",parentIds:"",type:he.dict.roleTypes[0].value,index:"",status:he.dict.status.normal},fe={components:{RoleResourceManager:de,RoleUserManager:ae},name:"role-manager",mixins:[X.a],props:{moduleId:{type:String,required:!0}},data:function(){var e=this;return{tableHeight:0,tabHeight:0,tabValue:"roleList",tabPanes:[],searchRole:{searchText:""},tableLoading:!1,roleList:[],limit:a()({},pe),checkedRoleList:[],rolePrefix:this.moduleId+"_",newRoleModel:!1,newRoleLoading:!1,newRole:{formWidth:500,ruleForm:a()({},me),rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],role:[{required:!0,message:"请输入角色标识符",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"},{validator:function(t,r,o){e.$ajax.post(RoleManagerUrl.post.validateRole,{role:""+e.rolePrefix+r,moduleId:e.moduleId}).success(!0,function(){return o()}).fail(!0,function(e){o(new Error(e.record))}).notSuccess(function(){o(new Error("校验失败"))})},trigger:"blur"}],type:[{required:!0,message:"请选择资源类型",trigger:"change"}]}},deleteRoleLoading:!1}},computed:{editCellCount:function(){var e=0;return this.roleList.forEach(function(t){for(var r in t)!0===t[r+"-edit"]&&e++}),e}},methods:{reGetRolePageList:function(){a()(this.limit,pe),this.getRoleList()},roleListProcess:function(e){for(var t in e)for(var r in e[t])e[t][r+"-edit"]=!1,e[t][r+"-loading"]=!1,e[t][r+"-edit-value"]=e[t][r];return e},getRoleList:function(){var e=this;this.tableLoading=!0,this.$ajax.get(RoleManagerUrl.get.roleList,{moduleId:this.moduleId,searchText:this.searchRole.searchText}).success(!0,function(t){e.roleList=e.roleListProcess(t.rows)}).finally(function(){return e.tableLoading=!1})},handleSizeChange:function(e){this.limit.pageSize=e,this.getRoleList()},handleCurrentChange:function(e){this.limit.currentPage=e,this.getRoleList()},handleChangeRoleStatus:function(e){var t=this;this.$ajax.put(RoleManagerUrl.put.roleStatus,e,{params:{moduleId:this.moduleId}}).success({message:"切换状态成功"}).notSuccess(function(){e.status===t.dict.status.normal?e.status=t.dict.status.disabled:e.status=t.dict.status.normal})},handleDbClickCell:function(e,t,r,o){!0===e.canEdit&&(e[t.columnKey+"-edit"]=!0)},handleClickEditCell:function(e,t,r){this.handleDbClickCell(e,t)},handleUnClickEditCell:function(e,t,r){!0===e.canEdit&&(e[t.columnKey+"-edit-value"]=e[""+t.columnKey],e[t.columnKey+"-edit"]=!1)},handleClickSaveCell:function(e,t,r){var o={moduleId:this.moduleId,id:e.id};e[t.columnKey+"-edit-value"]!==e[""+t.columnKey]?(o[t.columnKey]=e[t.columnKey+"-edit-value"],e[t.columnKey+"-loading"]=!0,this.$ajax.put(RoleManagerUrl.put.role,o).success(!0,function(){e[""+t.columnKey]=e[t.columnKey+"-edit-value"],e[t.columnKey+"-edit"]=!1}).finally(function(){return e[t.columnKey+"-loading"]=!1})):this.handleUnClickEditCell(e,t,r)},handleSelectionChange:function(e){this.checkedRoleList=e},formatterRoleType:function(e,t,r,o){for(var s in this.dict.roleTypes)if(this.dict.roleTypes[s].value===r)return this.dict.roleTypes[s].text;return"其它"},filterHandler:function(e,t,r){return t[r.property]===e},handleAddUserTab:function(e,t){for(var r in this.tabPanes)if(this.tabPanes[r].roleId===e.id&&"user"===this.tabPanes[r].type)return void(this.tabValue=""+r);this.tabPanes.push({id:e.id+"-user-"+t+"-"+parseInt(1e4*Math.random()),label:e.name+"-用户管理",roleId:e.id,role:e.role,roleName:e.name,type:"user"}),this.tabValue=""+(this.tabPanes.length-1)},handleAddResourceTab:function(e,t){for(var r in this.tabPanes)if(this.tabPanes[r].roleId===e.id&&"resource"===this.tabPanes[r].type)return void(this.tabValue=""+r);this.tabPanes.push({id:e.id+"-resource-"+t+"-"+parseInt(1e4*Math.random()),label:e.name+"-资源管理",roleId:e.id,role:e.role,roleName:e.name,type:"resource"}),this.tabValue=""+(this.tabPanes.length-1)},handleTabRemove:function(e){var t=parseInt(e);this.tabPanes.splice(t,1),0!==this.tabPanes.length?this.tabValue=t>0?""+--t:"0":this.tabValue="roleList"},handleClickNewRoleConfirmButton:function(){var e=this;this.$refs.newRoleForm.validate(function(t){if(t){e.newRoleLoading=!0;var r=a()({},e.newRole.ruleForm,{role:""+e.rolePrefix+e.newRole.ruleForm.role});e.$ajax.post(RoleManagerUrl.post.newRole,r,{params:{moduleId:e.moduleId}}).success("新建角色成功",function(t){e.reGetRolePageList()}).finally(function(){return e.newRoleLoading=!1})}})},handleClickDeleteCheckedRoles:function(){var e=this;this.$confirm('<div style="color: red">该操作将会删除勾选的角色和所有相关数据</div><div style="color: red">不可恢复！！！确定要这么做吗？？？</div>',function(t,r){e.deleteRoleLoading=!0,e.$ajax.delete(RoleManagerUrl.delete.roleList,{moduleId:e.moduleId,ids:e.checkedRoleList.map(function(e){return e.id}).toString()}).success("删除成功",function(){r(),e.reGetRolePageList()}).finally(function(){return e.deleteRoleLoading=!1})})},cancelAllEdit:function(){this.roleList.forEach(function(e){for(var t in e)e[t+"-edit"]=!1})},saveAllEdit:function(){this.$message.warn("暂不支持该功能")},handleExport:function(){this.$message.warn("暂不支持该功能")}},created:function(){this.getRoleList()},mounted:function(){var e=this;setTimeout(function(){e.tableHeight=document.body.clientHeight-225,e.tabHeight=document.body.clientHeight-46},0)}},ve={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-tabs",{style:{height:e.tabHeight+"px"},attrs:{type:"border-card"},on:{"tab-remove":e.handleTabRemove},model:{value:e.tabValue,callback:function(t){e.tabValue=t},expression:"tabValue"}},[r("el-tab-pane",{attrs:{label:"角色列表",name:"roleList"}},[r("div",{staticClass:"avalon-merlin-default-search-bar full avalon-merlin-a-scroll"},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("span",{staticClass:"btn-p-left"},[r("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",size:"small",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchRole.searchText,callback:function(t){e.$set(e.searchRole,"searchText",t)},expression:"searchRole.searchText"}})],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small"},on:{click:e.reGetRolePageList}},[e._v("搜索")])],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.newRoleModel=!0}}},[e._v("新建角色")])],1)])]),e._v(" "),r("div",{staticClass:"list-tools avalon-merlin-hidden",staticStyle:{"margin-top":"15px"}},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("el-button",{attrs:{type:"danger",size:"small",disabled:0===e.checkedRoleList.length,loading:e.deleteRoleLoading},on:{click:e.handleClickDeleteCheckedRoles}},[e._v("删除角色\n        ")]),e._v(" "),r("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.roleList.length>0,expression:"roleList.length > 0"}],staticStyle:{"margin-right":"5px"},attrs:{size:"small"}},[e._v("双击带编辑图标的单元格可以进行编辑")]),e._v(" "),r("el-tag",{attrs:{size:"small"}},[e._v("点击鼠标右键开启快捷菜单(未实现)")])],1),e._v(" "),r("div",{staticClass:"avalon-merlin-rfloat"},[r("el-button",{attrs:{type:"warning",size:"small",disabled:0===e.editCellCount},on:{click:e.cancelAllEdit}},[e._v("取消编辑\n        ")])],1)]),e._v(" "),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}]},[r("el-table",{attrs:{data:e.roleList,stripe:"",border:"",height:e.tableHeight},on:{"cell-dblclick":e.handleDbClickCell,"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),r("el-table-column",{attrs:{label:"角色名称","column-key":"name",prop:"name","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[!1===t.row.canEdit?[e._v(e._s(t.row[t.column.columnKey]))]:t.row[t.column.columnKey+"-edit"]?[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-revoke",attrs:{title:"撤销"},on:{click:function(r){r.stopPropagation(),e.handleUnClickEditCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:!t.row[t.column.columnKey+"-loading"],expression:"!scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-save",attrs:{title:"保存"},on:{click:function(r){r.stopPropagation(),e.handleClickSaveCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:t.row[t.column.columnKey+"-loading"],expression:"scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-loading-point-line we-icon-loading",attrs:{title:"保存中...请稍后"}})])]),e._v(" "),r("el-input",{attrs:{placeholder:"请输入角色名称",size:"mini"},model:{value:t.row[t.column.columnKey+"-edit-value"],callback:function(r){e.$set(t.row,t.column.columnKey+"-edit-value",r)},expression:"scope.row[`${scope.column.columnKey}-edit-value`]"}})]:[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-edit",attrs:{title:"编辑"},on:{click:function(r){r.stopPropagation(),e.handleClickEditCell(t.row,t.column,t.$index)}}})])]),e._v(" "),e._v("\n              "+e._s(t.row[t.column.columnKey])+"\n            ")]]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"角色标识符","column-key":"role",prop:"role","min-width":"200",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"角色类型","column-key":"type",prop:"type","min-width":"200",align:"center",formatter:e.formatterRoleType,filters:e.dict.roleTypes,"filter-method":e.filterHandler},scopedSlots:e._u([{key:"default",fn:function(t){return[!1===t.row.canEdit?[e._v(e._s(e.formatterRoleType(t.row,t.column,t.row[t.column.columnKey],t.$index))+"\n            ")]:t.row[t.column.columnKey+"-edit"]?[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-revoke",attrs:{title:"撤销"},on:{click:function(r){r.stopPropagation(),e.handleUnClickEditCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:!t.row[t.column.columnKey+"-loading"],expression:"!scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-save",attrs:{title:"保存"},on:{click:function(r){r.stopPropagation(),e.handleClickSaveCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:t.row[t.column.columnKey+"-loading"],expression:"scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-loading-point-line we-icon-loading",attrs:{title:"保存中...请稍后"}})])]),e._v(" "),r("el-select",{attrs:{placeholder:"请选择角色类型",size:"small"},model:{value:t.row[t.column.columnKey+"-edit-value"],callback:function(r){e.$set(t.row,t.column.columnKey+"-edit-value",r)},expression:"scope.row[`${scope.column.columnKey}-edit-value`]"}},e._l(e.dict.roleTypes,function(e,t){return r("el-option",{key:t,attrs:{label:e.text,title:e.value,value:e.value}})}))]:[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-edit",attrs:{title:"编辑"},on:{click:function(r){r.stopPropagation(),e.handleClickEditCell(t.row,t.column,t.$index)}}})])]),e._v(" "),e._v("\n              "+e._s(e.formatterRoleType(t.row,t.column,t.row[t.column.columnKey],t.$index))+"\n            ")]]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作","column-key":"permission",prop:"permission","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){e.handleAddUserTab(t.row,t.$index)}}},[e._v("用户管理\n            ")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){e.handleAddResourceTab(t.row,t.$index)}}},[e._v("资源管理\n            ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"状态","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[!1===t.row.canChangeStatus?[e._v("-")]:[r("el-switch",{attrs:{"active-text":"禁用","inactive-text":"取消","active-value":e.dict.status.disabled,"inactive-value":e.dict.status.normal,"active-color":"#f34444"},on:{change:function(r){e.handleChangeRoleStatus(t.row)}},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}})]]}}])})],1)],1),e._v(" "),r("we-layer",{attrs:{width:e.newRole.formWidth+250,height:450,"min-width":800,title:"新建角色","confirm-button-loading":e.newRoleLoading},on:{"click-confirm":e.handleClickNewRoleConfirmButton},model:{value:e.newRoleModel,callback:function(t){e.newRoleModel=t},expression:"newRoleModel"}},[r("el-form",{ref:"newRoleForm",staticStyle:{margin:"20px 10px 10px 10px"},attrs:{model:e.newRole.ruleForm,rules:e.newRole.rules,"label-width":"150px"}},[r("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[r("el-input",{style:{width:e.newRole.formWidth+"px"},attrs:{placeholder:"请输入角色名称",size:"small"},model:{value:e.newRole.ruleForm.name,callback:function(t){e.$set(e.newRole.ruleForm,"name",t)},expression:"newRole.ruleForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色标识符",prop:"role"}},[r("el-input",{staticStyle:{width:"100px"},attrs:{size:"small",disabled:""},model:{value:e.rolePrefix,callback:function(t){e.rolePrefix=t},expression:"rolePrefix"}}),e._v(" "),r("el-input",{style:{width:e.newRole.formWidth-105+"px"},attrs:{placeholder:"请输入角色标识符",size:"small"},model:{value:e.newRole.ruleForm.role,callback:function(t){e.$set(e.newRole.ruleForm,"role",t)},expression:"newRole.ruleForm.role"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色类型",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择角色类型",size:"small"},model:{value:e.newRole.ruleForm.type,callback:function(t){e.$set(e.newRole.ruleForm,"type",t)},expression:"newRole.ruleForm.type"}},e._l(e.dict.roleTypes,function(e,t){return r("el-option",{key:t,attrs:{label:e.text,title:e.value,value:e.value}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"角色描述",prop:"description"}},[r("el-input",{style:{width:e.newRole.formWidth+"px"},attrs:{type:"textarea",placeholder:"请输入角色描述",size:"small"},model:{value:e.newRole.ruleForm.description,callback:function(t){e.$set(e.newRole.ruleForm,"description",t)},expression:"newRole.ruleForm.description"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"立即使用",prop:"status"}},[r("el-switch",{attrs:{"active-text":"否","inactive-text":"是","active-value":e.dict.status.disabled,"inactive-value":e.dict.status.normal,"active-color":"#f34444"},model:{value:e.newRole.ruleForm.status,callback:function(t){e.$set(e.newRole.ruleForm,"status",t)},expression:"newRole.ruleForm.status"}})],1)],1)],1)],1),e._v(" "),e._l(e.tabPanes,function(t,o){return r("el-tab-pane",{key:t.id,attrs:{closable:"",lazy:"",label:t.label,name:""+o}},["user"===t.type?[r("span",{staticStyle:{color:"#f56c6c"},attrs:{slot:"label"},slot:"label"},[e._v(e._s(t.label))]),e._v(" "),r("role-user-manager",{attrs:{"module-id":e.moduleId,"role-id":t.roleId,role:t.role,"role-name":t.roleName}})]:e._e(),e._v(" "),"resource"===t.type?[r("span",{staticStyle:{color:"#409eff"},attrs:{slot:"label"},slot:"label"},[e._v(e._s(t.label))]),e._v(" "),r("role-resource-manager",{attrs:{"module-id":e.moduleId,"role-id":t.roleId,role:t.role,"role-name":t.roleName}})]:e._e()],2)})],2)},staticRenderFns:[]};var ge=r("vSla")(fe,ve,!1,function(e){r("mIKS")},"data-v-5f33b1b9",null).exports,Re=X.a.data(),we={currentPage:1,pageCount:1,pageSize:10,total:0},ye={id:"",name:"",type:Re.dict.resourceTypes[0].value,url:"",permission:"",path:"",description:"",parentId:"",parentIds:"",index:"",status:Re.dict.status.normal,roleIds:[]},xe={name:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择资源类型",trigger:"change"}],url:[{required:!0,message:"请输入资源地址",trigger:"blur"}],permission:[{required:!1,message:"请输入资源许可",trigger:"blur"}]},be={name:"res-manager",mixins:[X.a],data:function(){return{searchType:Re.dict.searchType.globalSearch,searchResource:{searchText:"",searchResourceTypes:[Re.dict.resourceType.url],parentIds:[]},tableLoading:!1,resourceList:[],limit:a()({},we),resourceListCacheIndex:0,resourceListCacheSize:10,roleList:[],checkedResourceList:[],searchResourceTreeModel:!1,searchResourceTreeLoading:!1,searchResourceTree:{searchTreeText:""},searchLocationResource:"",searchLocationExpandIds:[],searchResourceTreeList:[],newResourceModel:!1,newResourceLoading:!1,newResource:{formWidth:500,checkAllRoles:!1,indeterminateRoles:!1,ruleForm:a()({},ye),rules:a()({},xe),parentIds:[]},newResourceTreeLoading:!1,newResourceTree:{searchTreeText:""},newLocationResource:"",newLocationExpandIds:[],newResourceTreeList:[],deleteResourceLoading:!1}},props:{moduleId:{type:String,required:!0}},computed:{usableRoleList:function(){var e=[];for(var t in this.roleList)this.roleList[t].status===this.dict.status.normal&&e.push(this.roleList[t]);return e},unusableRoleList:function(){var e=[];for(var t in this.roleList)this.roleList[t].status===this.dict.status.disabled&&e.push(this.roleList[t]);return e},usableRoleIds:function(){var e=[];for(var t in this.roleList)this.roleList[t].status===this.dict.status.normal&&e.push(this.roleList[t].id);return e},editCellCount:function(){var e=0;return this.resourceList.forEach(function(t){for(var r in t)!0===t[r+"-edit"]&&e++}),e},searchResourceTreeRootIds:function(){var e=[],t=!0,r=!1,o=void 0;try{for(var s,n=J()(this.searchResourceTreeList);!(t=(s=n.next()).done);t=!0){var a=s.value;e.push(a.id)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}return e},newResourceTreeRootIds:function(){var e=[],t=!0,r=!1,o=void 0;try{for(var s,n=J()(this.newResourceTreeList);!(t=(s=n.next()).done);t=!0){var a=s.value;e.push(a.id)}}catch(e){r=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(r)throw o}}return e}},watch:{"newResource.ruleForm.type":{handler:function(e){switch(e){case"URL":this.newResource.rules.url[0].required=!0,this.newResource.rules.permission[0].required=!1;break;case"PERMISSION":this.newResource.rules.permission[0].required=!0,this.newResource.rules.url[0].required=!1;break;case"NODE":this.newResource.rules.permission[0].required=!1,this.newResource.rules.url[0].required=!1}},deep:!0},"searchResource.parentIds":{handler:function(e){this.searchType===this.dict.searchType.treeSearch&&this.reGetResourcePageList()},deep:!0},searchResourceTreeModel:function(e){this.searchType=e?this.dict.searchType.treeSearch:this.dict.searchType.globalSearch}},filters:{isRoleChecked:function(e,t){for(var r in e)if(e[r]===t)return!0;return!1}},methods:{handleChangeSearchType:function(){this.reGetResourcePageList()},resourceListProcess:function(e){for(var t in e){for(var r in e[t])e[t][r+"-edit"]=!1,e[t][r+"-loading"]=!1,e[t][r+"-edit-value"]=e[t][r];e[t].ownerRoleIds=[],e[t].indeterminateRoles=!1,e[t].checkAllRoles=!1}return e},getResourcePageList:function(){var e=this,t={moduleId:this.moduleId,currentPage:this.limit.currentPage,pageSize:this.limit.pageSize,searchText:this.searchResource.searchText,searchTypes:this.searchResource.searchResourceTypes.toString()};if(this.searchType===this.dict.searchType.treeSearch){var r=this.searchResource.parentIds;if(0===r.length)return this.tableLoading=!0,void this.$ajax.get(ResourceManagerUrl.get.rootResourcePageList,t).success({close:!0,callback:function(t){a()(e.limit,t.limit),e.resourceList=e.resourceListProcess(t.rows)}}).finally(function(){return e.tableLoading=!1});a()(t,{newParentIds:r.toString()})}this.tableLoading=!0,this.$ajax.get(ResourceManagerUrl.get.resourcePageList,t).success({close:!0,callback:function(t){a()(e.limit,t.limit),e.resourceList=e.resourceListProcess(t.rows)}}).finally(function(){return e.tableLoading=!1})},reGetResourcePageList:function(){a()(this.limit,we),this.getResourcePageList()},getRoleList:function(){var e=this;this.$ajax.get(RoleManagerUrl.get.roleList,{moduleId:this.moduleId}).success(!0,function(t){e.roleList=t.rows})},newResourceTreeListProcess:function(e){var t=this,r=[];return e.forEach(function(e){e.children=e.children?e.children:[],e.leaf=!e.childCount||0===e.childCount.length,e.disabled=!e.status||e.status===t.dict.status.disabled||"NODE"!==e.type,r.push(e)}),r},searchResourceTreeListProcess:function(e){var t=this,r=[];return e.forEach(function(e){e.children=e.children?e.children:[],e.leaf=!e.childCount||0===e.childCount.length,e.disabled=!e.status||e.status===t.dict.status.disabled||"NODE"!==e.type,r.push(e)}),r},getNewResourceTreeList:function(){var e=this;this.newResource.parentIds=[],this.newResourceTreeLoading=!0,this.$ajax.get(ResourceManagerUrl.get.rootResourceList,{moduleId:this.moduleId,searchText:this.newResourceTree.searchTreeText}).success(!0,function(t){e.newResourceTreeList=e.newResourceTreeListProcess(t.rows)}).finally(function(){return e.newResourceTreeLoading=!1})},getSearchResourceTreeList:function(){var e=this;this.searchResource.parentIds=[],this.searchResourceTreeLoading=!0,this.$ajax.get(ResourceManagerUrl.get.rootResourceList,{moduleId:this.moduleId,searchText:this.searchResourceTree.searchTreeText}).success(!0,function(t){e.searchResourceTreeList=e.searchResourceTreeListProcess(t.rows)}).finally(function(){return e.searchResourceTreeLoading=!1})},getNewResourceTreeChildNodeList:function(e,t){var r=this;this.$ajax.get(ResourceManagerUrl.get.childResourceList,{moduleId:this.moduleId,parentId:e.data.id}).success(!0,function(o){var s=r.newResourceTreeListProcess(o.rows);if(e.data.children=s,e.data.childCount=s.length,e.data.open=!0,t(s),r.searchLocationExpandIds&&r.searchLocationExpandIds.length>0){var n=r.$refs.searchResourceTree.getNode(r.searchLocationExpandIds[0]);r.searchLocationExpandIds=r.searchLocationExpandIds.slice(1),n&&!1===n.expanded&&n.expand()}if(r.newLocationExpandIds&&r.newLocationExpandIds.length>0){var a=r.$refs.newResourceTree.getNode(r.newLocationExpandIds[0]);r.newLocationExpandIds=r.newLocationExpandIds.slice(1),a&&!1===a.expanded&&a.expand()}})},getSearchResourceTreeChildNodeList:function(e,t){var r=this;this.$ajax.get(ResourceManagerUrl.get.childResourceList,{moduleId:this.moduleId,parentId:e.data.id}).success(!0,function(o){var s=r.searchResourceTreeListProcess(o.rows);if(e.data.children=s,e.data.childCount=s.length,e.data.open=!0,t(s),r.searchLocationExpandIds&&r.searchLocationExpandIds.length>0){var n=r.$refs.searchResourceTree.getNode(r.searchLocationExpandIds[0]);r.searchLocationExpandIds=r.searchLocationExpandIds.slice(1),n&&!1===n.expanded&&n.expand()}if(r.newLocationExpandIds&&r.newLocationExpandIds.length>0){var a=r.$refs.newResourceTree.getNode(r.newLocationExpandIds[0]);r.newLocationExpandIds=r.newLocationExpandIds.slice(1),a&&!1===a.expanded&&a.expand()}})},handleLocationSearchResourceTree:function(e,t){e?this.$ajax.get(ResourceManagerUrl.get.locationResourceList,{moduleId:this.moduleId,rootIds:this.searchResourceTreeRootIds.toString(),searchText:e}).success(!0,function(e){t(e.rows)}):t([])},handleSelectLocationSearchResource:function(e){this.searchLocationExpandIds=e.parentIds.substring(1).split("/"),this.expandSearchResourceNode()},expandSearchResourceNode:function(){var e=this.$refs.searchResourceTree.getNode(this.searchLocationExpandIds[0]);e&&(this.searchLocationExpandIds=this.searchLocationExpandIds.slice(1),!1===e.expanded?(e.expand(),this.expandSearchResourceNode()):this.expandSearchResourceNode())},handleCheckedSearchResourceTreeNode:function(e,t,r){if(r)this.searchResource.parentIds.push(t.id);else for(var o=this.searchResource.parentIds,s=0;s<o.length;s++)if(o[s]===t.id){o.splice(s,1);break}},handleCheckedNewResourceTreeNode:function(e,t,r){if(r)this.newResource.parentIds.push(t.id);else for(var o=this.newResource.parentIds,s=0;s<o.length;s++)if(o[s]===t.id){o.splice(s,1);break}},handleLocationNewResourceTree:function(e,t){e?this.$ajax.get(ResourceManagerUrl.get.locationResourceList,{moduleId:this.moduleId,rootIds:this.newResourceTreeRootIds.toString(),searchText:e}).success(!0,function(e){t(e.rows)}):t([])},handleSelectLocationNewResource:function(e){this.newLocationExpandIds=e.parentIds.substring(1).split("/"),this.expandNewResourceNode()},expandNewResourceNode:function(){var e=this.$refs.newResourceTree.getNode(this.newLocationExpandIds[0]);e&&(this.newLocationExpandIds=this.newLocationExpandIds.slice(1),!1===e.expanded?(e.expand(),this.expandNewResourceNode()):this.expandNewResourceNode())},handleSizeChange:function(e){this.limit.pageSize=e,this.getResourcePageList()},handleCurrentChange:function(e){this.limit.currentPage=e,this.getResourcePageList()},handleChangeResourceStatus:function(e){var t=this;this.$ajax.put(ResourceManagerUrl.put.resourceStatus,e,{params:{moduleId:this.moduleId}}).success({message:"切换状态成功"}).notSuccess(function(){e.status===t.dict.status.normal?e.status=t.dict.status.disabled:e.status=t.dict.status.normal})},formatterResourceType:function(e,t,r,o){for(var s in this.dict.resourceTypes)if(this.dict.resourceTypes[s].value===r)return this.dict.resourceTypes[s].text;return"未知"},handleCheckAllRoles:function(e,t){var r=this,o=[];if(e)return o=this.usableRoleList.map(function(e){return e.id}),void this.$ajax.post(RoleResourceManagerUrl.post.grantResourcesToRoles,{resourceIds:[t.id].toString(),roleIds:o.toString(),moduleId:this.moduleId}).success("授予角色成功",function(){var e=new W.a,o=!0,s=!1,n=void 0;try{for(var a,i=J()(t.ownerRoleIds);!(o=(a=i.next()).done);o=!0){var l=a.value;e.add(l)}}catch(e){s=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(s)throw n}}var c=!0,u=!1,d=void 0;try{for(var h,p=J()(r.usableRoleList);!(c=(h=p.next()).done);c=!0){var m=h.value;e.add(m.id)}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}t.ownerRoleIds=O()(e),t.indeterminateRoles=!1});this.$ajax.post(RoleResourceManagerUrl.post.unGrantResourcesToRoles,{resourceIds:[t.id].toString(),roleIds:o.toString(),moduleId:this.moduleId}).success("取消授予成功",function(){var e=!0,s=!1,n=void 0;try{for(var a,i=J()(t.ownerRoleIds);!(e=(a=i.next()).done);e=!0){var l=a.value,c=!0,u=!1,d=void 0;try{for(var h,p=J()(r.unusableRoleList);!(c=(h=p.next()).done);c=!0){if(h.value.id===l){o.push(l);break}}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}}}catch(e){s=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(s)throw n}}t.ownerRoleIds=o,t.indeterminateRoles=t.ownerRoleIds.length>0})},handleCheckRoleChange:function(e,t,r){e?this.$ajax.post(RoleResourceManagerUrl.post.grantResourceToRole,{resourceId:t.id,roleId:r.id,moduleId:this.moduleId}).success("授予角色成功"):this.$ajax.post(RoleResourceManagerUrl.post.unGrantResourceToRole,{resourceId:t.id,roleId:r.id,moduleId:this.moduleId}).success("取消授予成功")},newResourceCheckAllRoles:function(e){this.newResource.ruleForm.roleIds=e?this.usableRoleList.map(function(e){return e.id}):[],this.newResource.indeterminateRoles=!1},newResourceCheckRolesChange:function(e){var t=e.length;this.newResource.checkAllRoles=t===this.usableRoleList.length,this.newResource.indeterminateRoles=t>0&&t<this.usableRoleList.length},initResourceTreeNode:function(e,t){var r=!0,o=!1,s=void 0;try{for(var n,a=J()(t);!(r=(n=a.next()).done);r=!0){var i=n.value;if(i.leaf){if(i.id===e.parentId)return this.$refs.newResourceTree.getNode(i.id).isLeaf=!1,i.childCount=1,i.leaf=!1,!0}else{if(this.initResourceTreeNode(e,i.children))return!0;if(i.id===e.parentId)return i.open&&(i.childCount++,i.children.push(e)),!0}}}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return!1},initNewResourceTree:function(e,t){if(e&&0!==e.length){e=this.newResourceTreeListProcess(e);var r=!0,o=!1,s=void 0;try{for(var n,a=J()(e);!(r=(n=a.next()).done);r=!0){var i=n.value;if(null!=i.parentId&&""!==i.parentId.trim()){var l=!0,c=!1,u=void 0;try{for(var d,h=J()(t);!(l=(d=h.next()).done);l=!0){var p=d.value;if(p.leaf){if(p.id===i.parentId){this.$refs.newResourceTree.getNode(p.id).isLeaf=!1,p.childCount=1,p.leaf=!1;break}}else{if(this.initResourceTreeNode(i,p.children))break;if(p.id===i.parentId){p.open&&(p.childCount++,p.children.push(i));break}}}}catch(e){c=!0,u=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw u}}}else t.push(i)}}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}}},handleClickNewResourceConfirmButton:function(e,t){var r=this;this.$refs.newResourceForm.validate(function(e){e&&(r.newResourceLoading=!0,r.$ajax.post(ResourceManagerUrl.post.newResource,a()(r.newResource.ruleForm,{roleIds:r.newResource.ruleForm.roleIds.toString(),newParentIds:r.newResource.parentIds.toString()}),{params:{moduleId:r.moduleId}}).success("新建资源成功",function(e){r.initNewResourceTree(e.rows,r.newResourceTreeList)}).finally(function(){return r.newResourceLoading=!1}))})},cancelAllEdit:function(){this.resourceList.forEach(function(e){for(var t in e)e[t+"-edit"]=!1})},saveAllEdit:function(){this.$message.warn("暂不支持该功能")},cancelAllEditSure:function(e){var t=this;this.editCellCount>0?this.$confirm({message:"是否取消编辑中的单元格?",clickConfirm:function(r,o){t.cancelAllEdit(),o(),e()}}):e()},handleExpandChange:function(e,t){var r=this;e.ownerRoleIds.length>0||this.$ajax.get(RoleResourceManagerUrl.get.roleResourceListByResourceId,{resourceId:e.id,moduleId:this.moduleId}).success(!0,function(t){e.ownerRoleIds=t.rows.map(function(e){return e.roleId}),e.ownerRoleIds.length>0&&(e.indeterminateRoles=!0);var o=void 0,s=!0,n=!1,a=void 0;try{for(var i,l=J()(r.usableRoleIds);!(s=(i=l.next()).done);s=!0){var c=i.value;o=!1;var u=!0,d=!1,h=void 0;try{for(var p,m=J()(e.ownerRoleIds);!(u=(p=m.next()).done);u=!0){if(c===p.value){o=!0;break}}}catch(e){d=!0,h=e}finally{try{!u&&m.return&&m.return()}finally{if(d)throw h}}if(!o)return}}catch(e){n=!0,a=e}finally{try{!s&&l.return&&l.return()}finally{if(n)throw a}}e.checkAllRoles=!0})},handleDbClickCell:function(e,t,r,o){!0!==e.canEdit||e.type===this.dict.resourceType.node&&"name"!==t.columnKey||(e[t.columnKey+"-edit"]=!0)},handleClickEditCell:function(e,t,r){this.handleDbClickCell(e,t,r)},handleUnClickEditCell:function(e,t,r){!0===e.canEdit&&(e[t.columnKey+"-edit-value"]=e[""+t.columnKey],e[t.columnKey+"-edit"]=!1)},handleClickSaveCell:function(e,t,r){var o={moduleId:this.moduleId,id:e.id};e[t.columnKey+"-edit-value"]!==e[""+t.columnKey]?(o[t.columnKey]=e[t.columnKey+"-edit-value"],e[t.columnKey+"-loading"]=!0,this.$ajax.put(ResourceManagerUrl.put.resource,o).success(!0,function(){e[""+t.columnKey]=e[t.columnKey+"-edit-value"],e[t.columnKey+"-edit"]=!1}).finally(function(){return e[t.columnKey+"-loading"]=!1})):this.handleUnClickEditCell(e,t,r)},handleSelectionChange:function(e){this.checkedResourceList=e},handleClickDeleteCheckedResources:function(){var e=this;this.$confirm('<div style="color: red">该操作将会删除勾选的资源和所有附属资源及相关数据</div><div style="color: red">不可恢复！！！确定要这么做吗？？？</div>',function(t,r){e.deleteResourceLoading=!0,e.$ajax.delete(ResourceManagerUrl.delete.resourceList,{moduleId:e.moduleId,ids:e.checkedResourceList.map(function(e){return e.id}).toString()}).success("删除成功",function(){r(),e.reGetResourcePageList()}).finally(function(){return e.deleteResourceLoading=!1})})},handleExport:function(){this.$message.warn("暂不支持该功能")},handleDblClickTreeNode:function(e,t){t.childCount>0&&(e.expanded?e.collapse():e.expand())}},mounted:function(){var e=this;this.getRoleList(),this.getResourcePageList(),window.events.on("clickF2",function(t){e.cancelAllEditSure(function(){e.searchResourceTreeModel=!e.searchResourceTreeModel})})}},Le={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"avalon-merlin-default-search-bar avalon-merlin-a-scroll"},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("span",{staticClass:"btn-p-left"},[r("el-select",{staticStyle:{width:"360px"},attrs:{size:"small",multiple:"",placeholder:"请选择资源类型"},model:{value:e.searchResource.searchResourceTypes,callback:function(t){e.$set(e.searchResource,"searchResourceTypes",t)},expression:"searchResource.searchResourceTypes"}},e._l(e.dict.resourceTypes,function(e,t){return r("el-option",{key:t,attrs:{label:e.text,value:e.value}})}))],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",size:"small",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchResource.searchText,callback:function(t){e.$set(e.searchResource,"searchText",t)},expression:"searchResource.searchText"}})],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small"},on:{click:e.reGetResourcePageList}},[e._v("搜索")])],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){e.cancelAllEditSure(function(){return e.searchResourceTreeModel=!e.searchResourceTreeModel})}}},[e._v("\n          资源树(F2)\n        ")])],1),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.cancelAllEditSure(function(){return e.newResourceModel=!0})}}},[e._v("新建资源\n        ")])],1)])]),e._v(" "),r("div",[r("div",{staticClass:"list-tools avalon-merlin-hidden"},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("el-button",{attrs:{type:"danger",size:"small",disabled:0===e.checkedResourceList.length,loading:e.deleteResourceLoading},on:{click:e.handleClickDeleteCheckedResources}},[e._v("删除资源\n        ")]),e._v(" "),r("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.resourceList.length>0,expression:"resourceList.length > 0"}],staticStyle:{"margin-right":"5px"},attrs:{size:"small"}},[e._v("双击带编辑图标的单元格可以进行编辑")]),e._v(" "),r("el-tag",{attrs:{size:"small"}},[e._v("点击鼠标右键开启快捷菜单(未实现)")])],1),e._v(" "),r("div",{staticClass:"avalon-merlin-rfloat"},[r("el-button",{attrs:{type:"warning",size:"small",disabled:0===e.editCellCount},on:{click:e.cancelAllEdit}},[e._v("取消编辑")])],1)]),e._v(" "),r("div",{staticClass:"avalon-merlin-default-list"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{overflow:"inherit"},attrs:{data:e.resourceList,stripe:"",border:"",height:"100%"},on:{"expand-change":e.handleExpandChange,"cell-dblclick":e.handleDbClickCell,"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),e.roleList&&e.roleList.length>0?r("el-table-column",{attrs:{type:"expand",label:"所属角色列表",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.type===e.dict.resourceType.node?[e._v("节点不能授予角色")]:[r("el-checkbox",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},attrs:{indeterminate:t.row.indeterminateRoles},on:{change:function(r){e.handleCheckAllRoles(r,t.row)}},model:{value:t.row.checkAllRoles,callback:function(r){e.$set(t.row,"checkAllRoles",r)},expression:"scope.row.checkAllRoles"}},[e._v("全选\n              ")]),e._v(" "),r("el-tag",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},attrs:{size:"small"}},[e._v("点击按钮可以给该当前行用户授予或取消角色")]),e._v(" "),r("el-tag",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},attrs:{size:"small"}},[e._v("绿色背景的角色来源于其它服务")]),e._v(" "),r("el-checkbox-group",{attrs:{size:"small"},model:{value:t.row.ownerRoleIds,callback:function(r){e.$set(t.row,"ownerRoleIds",r)},expression:"scope.row.ownerRoleIds"}},[e._l(e.roleList,function(o){return[r("el-checkbox",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},style:{backgroundColor:o.type===e.dict.roleType.local?void 0:"#67c23a66"},attrs:{label:o.id,title:o.role,disabled:o.status===e.dict.status.disabled,border:""},on:{change:function(r){e.handleCheckRoleChange(r,t.row,o)}}},[e._v(e._s(o.name)+"\n                  ")])]})],2)]]}}])}):e._e(),e._v(" "),r("el-table-column",{attrs:{label:"所属节点","column-key":"parentResourceName",prop:"parentResourceName","min-width":"200",align:"center",formatter:function(e,t,r,o){return e.parentResourceName&&""!==e.parentResourceName?e.parentResourceName:"-"}}}),e._v(" "),r("el-table-column",{attrs:{label:"资源名称","column-key":"name",prop:"name","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row[t.column.columnKey+"-edit"]?[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-revoke",attrs:{title:"撤销"},on:{click:function(r){r.stopPropagation(),e.handleUnClickEditCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:!t.row[t.column.columnKey+"-loading"],expression:"!scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-save",attrs:{title:"保存"},on:{click:function(r){r.stopPropagation(),e.handleClickSaveCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:t.row[t.column.columnKey+"-loading"],expression:"scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-loading-point-line we-icon-loading",attrs:{title:"保存中...请稍后"}})])]),e._v(" "),r("el-input",{attrs:{placeholder:"请输入资源名称",size:"mini"},model:{value:t.row[t.column.columnKey+"-edit-value"],callback:function(r){e.$set(t.row,t.column.columnKey+"-edit-value",r)},expression:"scope.row[`${scope.column.columnKey}-edit-value`]"}})]:[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-edit",attrs:{title:"编辑"},on:{click:function(r){r.stopPropagation(),e.handleClickEditCell(t.row,t.column,t.$index)}}})])]),e._v(" "),e._v("\n              "+e._s(t.row[t.column.columnKey])+"\n            ")]]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"资源类型","column-key":"type",prop:"type","min-width":"200",align:"center",formatter:e.formatterResourceType,"cell-mouse-enter":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row[t.column.columnKey+"-edit"]?[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-revoke",attrs:{title:"撤销"},on:{click:function(r){r.stopPropagation(),e.handleUnClickEditCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:!t.row[t.column.columnKey+"-loading"],expression:"!scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-save",attrs:{title:"保存"},on:{click:function(r){r.stopPropagation(),e.handleClickSaveCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:t.row[t.column.columnKey+"-loading"],expression:"scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-loading-point-line we-icon-loading",attrs:{title:"保存中...请稍后"}})])]),e._v(" "),r("el-select",{attrs:{placeholder:"请选择资源类型",size:"small"},model:{value:t.row[t.column.columnKey+"-edit-value"],callback:function(r){e.$set(t.row,t.column.columnKey+"-edit-value",r)},expression:"scope.row[`${scope.column.columnKey}-edit-value`]"}},e._l(e.dict.resourceTypes,function(t,o){return t.value!==e.dict.resourceType.node?r("el-option",{key:o,attrs:{label:t.text,title:t.value,value:t.value}}):e._e()}))]:[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{directives:[{name:"show",rawName:"v-show",value:t.row.type!==e.dict.resourceType.node,expression:"scope.row.type !== dict.resourceType.node"}],staticClass:"we-icon-edit",attrs:{title:"编辑"},on:{click:function(r){r.stopPropagation(),e.handleClickEditCell(t.row,t.column,t.$index)}}})])]),e._v(" "),e._v("\n              "+e._s(e.formatterResourceType(t.row,t.column,t.row[t.column.columnKey],t.$index))+"\n            ")]]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"资源地址","column-key":"url",prop:"url","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.type===e.dict.resourceType.node?[e._v("-")]:t.row[t.column.columnKey+"-edit"]?[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-revoke",attrs:{title:"撤销"},on:{click:function(r){r.stopPropagation(),e.handleUnClickEditCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:!t.row[t.column.columnKey+"-loading"],expression:"!scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-save",attrs:{title:"保存"},on:{click:function(r){r.stopPropagation(),e.handleClickSaveCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:t.row[t.column.columnKey+"-loading"],expression:"scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-loading-point-line we-icon-loading",attrs:{title:"保存中...请稍后"}})])]),e._v(" "),r("el-input",{attrs:{placeholder:"请输入资源地址",size:"mini"},model:{value:t.row[t.column.columnKey+"-edit-value"],callback:function(r){e.$set(t.row,t.column.columnKey+"-edit-value",r)},expression:"scope.row[`${scope.column.columnKey}-edit-value`]"}})]:[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-edit",attrs:{title:"编辑"},on:{click:function(r){r.stopPropagation(),e.handleClickEditCell(t.row,t.column,t.$index)}}})])]),e._v(" "),e._v("\n              "+e._s(t.row[t.column.columnKey])+"\n            ")]]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"资源许可","column-key":"permission",prop:"permission","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.type===e.dict.resourceType.node?[e._v("-")]:t.row[t.column.columnKey+"-edit"]?[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-revoke",attrs:{title:"撤销"},on:{click:function(r){r.stopPropagation(),e.handleUnClickEditCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:!t.row[t.column.columnKey+"-loading"],expression:"!scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-save",attrs:{title:"保存"},on:{click:function(r){r.stopPropagation(),e.handleClickSaveCell(t.row,t.column,t.$index)}}}),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:t.row[t.column.columnKey+"-loading"],expression:"scope.row[`${scope.column.columnKey}-loading`]"}],staticClass:"we-icon-loading-point-line we-icon-loading",attrs:{title:"保存中...请稍后"}})])]),e._v(" "),r("el-input",{attrs:{placeholder:"请输入资源地址",size:"mini"},model:{value:t.row[t.column.columnKey+"-edit-value"],callback:function(r){e.$set(t.row,t.column.columnKey+"-edit-value",r)},expression:"scope.row[`${scope.column.columnKey}-edit-value`]"}})]:[r("div",{staticClass:"module-tools"},[r("div",{staticClass:"tools-right"},[r("i",{staticClass:"we-icon-edit",attrs:{title:"编辑"},on:{click:function(r){r.stopPropagation(),e.handleClickEditCell(t.row,t.column,t.$index)}}})])]),e._v(" "),e._v("\n              "+e._s(t.row[t.column.columnKey])+"\n            ")]]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"状态","min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.type===e.dict.resourceType.node?[e._v("-")]:r("el-switch",{attrs:{"active-text":"禁用","inactive-text":"取消","active-value":e.dict.status.disabled,"inactive-value":e.dict.status.normal,"active-color":"#f34444"},on:{change:function(r){e.handleChangeResourceStatus(t.row)}},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}})]}}])})],1)],1)]),e._v(" "),r("div",{staticClass:"avalon-merlin-default-list-page"},[r("el-pagination",{attrs:{"current-page":e.limit.currentPage,"page-sizes":[10,50,100,200,300,400],"page-size":e.limit.pageSize,total:e.limit.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),r("we-layer",{attrs:{width:40,height:100,"show-mask":!1,"show-footer":!1,drag:"",resize:"","z-index":2e3,"drag-out-the-screen":"","min-width":400,"min-height":300,position:"right",title:"资源树"},model:{value:e.searchResourceTreeModel,callback:function(t){e.searchResourceTreeModel=t},expression:"searchResourceTreeModel"}},[r("div",{staticClass:"avalon-merlin-pa-small"},[r("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",clearable:"",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchResourceTree.searchTreeText,callback:function(t){e.$set(e.searchResourceTree,"searchTreeText",t)},expression:"searchResourceTree.searchTreeText"}}),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small",loading:e.searchResourceTreeLoading},on:{click:e.getSearchResourceTreeList}},[e._v("根节点搜索")])],1),e._v(" "),r("el-switch",{staticStyle:{"margin-left":"10px"},attrs:{"active-text":e.dict.searchTypes[0].text,"inactive-text":"资源"+e.dict.searchTypes[1].text,"active-value":e.dict.searchTypes[0].value,"inactive-value":e.dict.searchTypes[1].value,"active-color":"#f34444"},on:{change:e.handleChangeSearchType},model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}}),e._v(" "),r("div",{staticStyle:{clear:"both",padding:"10px 0"}},[r("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.searchResourceTreeList.length>0,expression:"searchResourceTreeList.length > 0"}],attrs:{size:"small"}},[e._v("双击节点名称可以展开/收缩节点")]),e._v(" "),r("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.searchResourceTreeList.length>0,expression:"searchResourceTreeList.length > 0"}],attrs:{size:"small"}},[e._v("拖动节点可以调整顺序和层级(未实现)")])],1),e._v(" "),r("div",{staticClass:"tree-module"},[r("el-autocomplete",{directives:[{name:"show",rawName:"v-show",value:e.searchResourceTreeList.length>0,expression:"searchResourceTreeList.length > 0"}],staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"资源定位",debounce:1e3,"value-key":"locationName","fetch-suggestions":e.handleLocationSearchResourceTree,"prefix-icon":"el-icon-search"},on:{select:e.handleSelectLocationSearchResource},model:{value:e.searchLocationResource,callback:function(t){e.searchLocationResource=t},expression:"searchLocationResource"}}),e._v(" "),r("div",{staticClass:"tree-module-inner avalon-merlin-v-scroll"},[r("el-tree",{ref:"searchResourceTree",attrs:{data:e.searchResourceTreeList,"highlight-current":!0,draggable:!0,"check-strictly":!0,lazy:"","expand-on-click-node":!1,props:{label:"name",isLeaf:"leaf"},load:e.getSearchResourceTreeChildNodeList,"node-key":"id","empty-text":"暂无资源"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,s=t.data;return r("span",{},["NODE"===s.type?r("el-checkbox",{on:{change:function(t){e.handleCheckedSearchResourceTreeNode(o,s,t)}}}):e._e(),e._v(" "),r("i",{staticClass:"we-icon-save"}),e._v(" "),r("span",{on:{dblclick:function(t){e.handleDblClickTreeNode(o,s)}}},[e._v(e._s(o.label))])],1)}}])})],1)],1)],1)]),e._v(" "),r("we-layer",{attrs:{width:50,height:100,"min-width":800,"resize-position":["right"],position:"left",title:"新建资源","z-index":2e3,"confirm-button-loading":e.newResourceLoading},on:{"click-confirm":e.handleClickNewResourceConfirmButton},model:{value:e.newResourceModel,callback:function(t){e.newResourceModel=t},expression:"newResourceModel"}},[r("el-form",{ref:"newResourceForm",staticStyle:{"margin-top":"30px"},attrs:{model:e.newResource.ruleForm,rules:e.newResource.rules,"label-width":"200px"}},[r("el-form-item",{attrs:{label:"资源名称",prop:"name"}},[r("el-input",{style:{width:e.newResource.formWidth+"px"},attrs:{placeholder:"请输入资源名称",size:"small"},model:{value:e.newResource.ruleForm.name,callback:function(t){e.$set(e.newResource.ruleForm,"name",t)},expression:"newResource.ruleForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"资源类型",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择资源类型",size:"small"},model:{value:e.newResource.ruleForm.type,callback:function(t){e.$set(e.newResource.ruleForm,"type",t)},expression:"newResource.ruleForm.type"}},e._l(e.dict.resourceTypes,function(e,t){return r("el-option",{key:t,attrs:{label:e.text,title:e.value,value:e.value}})}))],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"NODE"!==e.newResource.ruleForm.type,expression:"newResource.ruleForm.type !== 'NODE'"}],attrs:{label:"资源地址",prop:"url"}},[r("el-input",{style:{width:e.newResource.formWidth+"px"},attrs:{placeholder:"请输入资源请求地址URL(相对路径)",size:"small"},model:{value:e.newResource.ruleForm.url,callback:function(t){e.$set(e.newResource.ruleForm,"url",t)},expression:"newResource.ruleForm.url"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"NODE"!==e.newResource.ruleForm.type,expression:"newResource.ruleForm.type !== 'NODE'"}],attrs:{label:"资源许可",prop:"permission"}},[r("el-input",{style:{width:e.newResource.formWidth+"px"},attrs:{placeholder:"请输入资源许可(用于Shiro注解)",size:"small"},model:{value:e.newResource.ruleForm.permission,callback:function(t){e.$set(e.newResource.ruleForm,"permission",t)},expression:"newResource.ruleForm.permission"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"资源描述",prop:"description"}},[r("el-input",{style:{width:e.newResource.formWidth+"px"},attrs:{type:"textarea",placeholder:"请输入资源描述",size:"small"},model:{value:e.newResource.ruleForm.description,callback:function(t){e.$set(e.newResource.ruleForm,"description",t)},expression:"newResource.ruleForm.description"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"NODE"!==e.newResource.ruleForm.type,expression:"newResource.ruleForm.type !== 'NODE'"}],attrs:{label:"立即使用",prop:"status"}},[r("el-switch",{attrs:{"active-text":"否","inactive-text":"是","active-value":e.dict.status.disabled,"inactive-value":e.dict.status.normal,"active-color":"#f34444"},model:{value:e.newResource.ruleForm.status,callback:function(t){e.$set(e.newResource.ruleForm,"status",t)},expression:"newResource.ruleForm.status"}})],1),e._v(" "),e.roleList&&e.roleList.length>0&&"NODE"!==e.newResource.ruleForm.type?r("el-form-item",{attrs:{label:"使用该资源的角色",prop:"roleIds"}},[r("el-checkbox",{attrs:{indeterminate:e.newResource.indeterminateRoles},on:{change:e.newResourceCheckAllRoles},model:{value:e.newResource.checkAllRoles,callback:function(t){e.$set(e.newResource,"checkAllRoles",t)},expression:"newResource.checkAllRoles"}},[e._v("全选\n        ")]),e._v(" "),r("el-checkbox-group",{style:{width:e.newResource.formWidth+"px"},attrs:{size:"small"},on:{change:e.newResourceCheckRolesChange},model:{value:e.newResource.ruleForm.roleIds,callback:function(t){e.$set(e.newResource.ruleForm,"roleIds",t)},expression:"newResource.ruleForm.roleIds"}},[e._l(e.roleList,function(t){return[r("el-checkbox",{staticStyle:{"margin-left":"0px","margin-right":"10px"},style:{backgroundColor:t.type===e.dict.roleType.local?void 0:"#67c23a66"},attrs:{label:t.id,title:t.role,disabled:t.status===e.dict.status.disabled,border:""}},[e._v(e._s(t.name)+"\n            ")])]})],2)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"上级节点",prop:"roles"}},[r("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",clearable:"",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.newResourceTree.searchTreeText,callback:function(t){e.$set(e.newResourceTree,"searchTreeText",t)},expression:"newResourceTree.searchTreeText"}}),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small",loading:e.newResourceTreeLoading},on:{click:e.getNewResourceTreeList}},[e._v("根节点搜索")])],1),e._v(" "),r("div",{staticClass:"tree-module-default",staticStyle:{width:"480px","margin-top":"5px"}},[r("el-autocomplete",{directives:[{name:"show",rawName:"v-show",value:e.newResourceTreeList.length>0,expression:"newResourceTreeList.length > 0"}],staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"资源定位",debounce:1e3,"value-key":"locationName","fetch-suggestions":e.handleLocationNewResourceTree,"prefix-icon":"el-icon-search"},on:{select:e.handleSelectLocationNewResource},model:{value:e.newLocationResource,callback:function(t){e.newLocationResource=t},expression:"newLocationResource"}}),e._v(" "),r("div",{staticClass:"tree-module-default-inner avalon-merlin-v-scroll",staticStyle:{height:"400px"}},[r("el-tree",{ref:"newResourceTree",attrs:{data:e.newResourceTreeList,"highlight-current":!0,"check-strictly":!0,lazy:"","expand-on-click-node":!1,props:{label:"name",isLeaf:"leaf"},load:e.getNewResourceTreeChildNodeList,"node-key":"id","empty-text":"暂无资源"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,s=t.data;return r("span",{},["NODE"===s.type?r("el-checkbox",{on:{change:function(t){e.handleCheckedNewResourceTreeNode(o,s,t)}}}):e._e(),e._v(" "),r("i",{staticClass:"we-icon-save"}),e._v(" "),r("span",{on:{dblclick:function(t){e.handleDblClickTreeNode(o,s)}}},[e._v(e._s(o.label))])],1)}}])})],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var Ce=r("vSla")(be,Le,!1,function(e){r("BKAK")},"data-v-6f81cda1",null).exports;
/*!
 * Title:
 * Description: 路由管理
 * author: 白超
 * date: 2017/12/5
 * version: v1.0
 */
o.default.use(s.a);var Ie=new s.a({routes:[{path:"/",redirect:{name:"Layout"}},{path:"/",name:"Layout",component:S,redirect:{name:"Manager"},children:[{path:"/manager/:moduleId",name:"Manager",props:!0,component:q,redirect:{name:"UserManager"},children:[{path:"/userManager/:moduleId",name:"UserManager",props:!0,component:ee},{path:"/roleManager/:moduleId",name:"RoleManager",props:!0,component:ge},{path:"/resManager/:moduleId",name:"ResManager",props:!0,component:Ce}]}]}]}),ke={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"index"}},[t("router-view")],1)},staticRenderFns:[]},Te=r("vSla")({name:"index"},ke,!1,null,null,null).exports;
/*!
 * Title: 系统模块
 * Description:
 * author: 白超
 * date: 2017/12/5
 * version: v1.0
 */
new o.default({el:"#index",router:Ie,template:"<index/>",components:{Index:Te}})},XQXf:function(e,t,r){"use strict";t.a={data:function(){return{dict:{status:{normal:"NORMAL",enabled:"ENABLED",disabled:"DISABLED",deleted:"DELETED"},searchType:{globalSearch:"GlobalSearch",treeSearch:"TreeSearch"},searchTypes:[{text:"全局查询",value:"GlobalSearch"},{text:"树查询",value:"TreeSearch"}],resourceType:{url:"URL",permission:"PERMISSION",node:"NODE"},resourceTypes:[{text:"统一资源定位符",value:"URL"},{text:"资源许可(Shiro注解用)",value:"PERMISSION"},{text:"节点",value:"NODE"}],roleType:{local:"LOCAL"},roleTypes:[{text:"本地角色",value:"LOCAL"}]}}}}},Z2Ou:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAABKCAMAAAArDjJDAAAAZlBMVEVxwXX+//57xn/e8d90w3jL6c2b053////B5MPg8uHt+O74/fmh1qSDyYb8/vys266137em2KiMzY+Iy4t4xXz1+/by+fLk8+SQz5PZ79vn9ei84r7Q69HV7dbH58jD5cV+x4Kv3LEGAUyCAAACa0lEQVRYw+2XzZKjMAyE22DTYMDhzwYSSDLv/5J7gGSyTHawa6d2L/SRoj5kWS0J4NChQ4f+sYY0zv6s+NL6gqLU8Xudq86PlHFfsxcrJTmm3ykmefHJk6W4fP/NLhV0pVdQo9zLQU9T7KNiMt19SVGc9lGZH4r/F1Um0Q+h2p6q+xFUq0kX/R2qHACgOZN5AUAmT90DUc3ZnoCmJ00NQKo8t9Zaa3MTt2GogjR12a8xobMv/kvCUJ0irX6QgDp+qL90gbmSiiTz+um76CEAmIJuUKpX0tbzM6uAYpCT3lpW3suyXEqjqoPq6r4J5WM+O6fjNOkAyHDjJNXSmVr1eYtZ4dWPN6gi5yQB1I4kjXW5IWmuUTCqyJdO+CFIE1dDeW+LqyY5R96o5CRXkm6AwpD6mehWkUusPqjEUMmF1AKtI/vX4XchPaphRZFMC7vEBLUQX3Qlbet5wEqQhtQDgMZSrKcbavkYFPthPdJeCa4kVGS8EBr3GIAnMo58b7BaTwc5UqwR1ILj2qc188S7GD7Uko37mfmwogz7oqhbQM7kLXjilI62fEYljDFuAK58BBiGcqsdE7E4pwBSMgtHaebrxctqnOd5rJbuNwWjuvhlQ5BSSrk+rINRuJFq+1piqMtwVEK65uskVDIcFfVf3FsIir2yersUFWKz5g2WnHdbw9tVTZG8fqamcF/8/U6te7NARjPJ/lR2gIwSZUibeLTRC8n4ZYm9pSUQTSSpx2s69Yak9iEhirebdX8HZKVfnkyePwHRRW9YWQOgrbJckDRaJfBW+/uPSaxvEgCiJB2z6VRKHDp06NB/0C+QsCjtEww+QgAAAABJRU5ErkJggg=="},b4tm:function(e,t,r){var o=r("8Nvm"),s=r("JBI7"),n=r("biYF")("species");e.exports=function(e){var t;return s(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!s(t.prototype)||(t=void 0),o(t)&&null===(t=t[n])&&(t=void 0)),void 0===t?Array:t}},bJpG:function(e,t,r){r("vyS5")("Map")},bodH:function(e,t,r){var o=r("bHZz");e.exports=function(e,t,r){for(var s in t)r&&e[s]?e[s]=t[s]:o(e,s,t[s]);return e}},cUn4:function(e,t,r){e.exports={default:r("G/71"),__esModule:!0}},dC2g:function(e,t,r){var o=r("b4tm");e.exports=function(e,t){return new(o(e))(t)}},"k/7E":function(e,t,r){var o=r("WwGG"),s=r("kDTw"),n=r("V2W7"),a=r("93K8"),i=r("CFGK"),l=r("YW8S"),c={},u={};(t=e.exports=function(e,t,r,d,h){var p,m,f,v,g=h?function(){return e}:l(e),R=o(r,d,t?2:1),w=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(n(g)){for(p=i(e.length);p>w;w++)if((v=t?R(a(m=e[w])[0],m[1]):R(e[w]))===c||v===u)return v}else for(f=g.call(e);!(m=f.next()).done;)if((v=s(f,R,m.value,t))===c||v===u)return v}).BREAK=c,t.RETURN=u},kDTw:function(e,t,r){var o=r("93K8");e.exports=function(e,t,r,s){try{return s?t(o(r)[0],r[1]):t(r)}catch(t){var n=e.return;throw void 0!==n&&o(n.call(e)),t}}},kfHR:function(e,t,r){e.exports={default:r("qQfv"),__esModule:!0}},kksE:function(e,t,r){"use strict";var o=r("lIiZ"),s=r("go9Q");e.exports=function(e,t,r){t in e?o.f(e,t,s(0,r)):e[t]=r}},mIKS:function(e,t){},oltR:function(e,t,r){"use strict";var o=r("MxwP"),s=r("27tL");e.exports=r("4HpA")("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return o.def(s(this,"Set"),e=0===e?0:e,e)}},o)},qQfv:function(e,t,r){r("IsPG"),r("yrDz"),e.exports=r("AKd3").Array.from},stem:function(e,t,r){r("SMmX")("Map")},t8DS:function(e,t){e.exports=function(e,t,r,o){if(!(e instanceof t)||void 0!==o&&o in e)throw TypeError(r+": incorrect invocation!");return e}},toDE:function(e,t,r){r("SMmX")("Set")},uLBH:function(e,t){},uhis:function(e,t,r){"use strict";var o=r("MxwP"),s=r("27tL");e.exports=r("4HpA")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=o.getEntry(s(this,"Map"),e);return t&&t.v},set:function(e,t){return o.def(s(this,"Map"),0===e?0:e,t)}},o,!0)},vhYp:function(e,t,r){var o=r("k/7E");e.exports=function(e,t){var r=[];return o(e,!1,r.push,r,t),r}},vyS5:function(e,t,r){"use strict";var o=r("FITv");e.exports=function(e){o(o.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},yrDz:function(e,t,r){"use strict";var o=r("WwGG"),s=r("FITv"),n=r("OXaN"),a=r("kDTw"),i=r("V2W7"),l=r("CFGK"),c=r("kksE"),u=r("YW8S");s(s.S+s.F*!r("75+0")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,s,d,h=n(e),p="function"==typeof this?this:Array,m=arguments.length,f=m>1?arguments[1]:void 0,v=void 0!==f,g=0,R=u(h);if(v&&(f=o(f,m>2?arguments[2]:void 0,2)),void 0==R||p==Array&&i(R))for(r=new p(t=l(h.length));t>g;g++)c(r,g,v?f(h[g],g):h[g]);else for(d=R.call(h),r=new p;!(s=d.next()).done;g++)c(r,g,v?a(d,f,[s.value,g],!0):s.value);return r.length=g,r}})},zsLt:function(e,t,r){e.exports={default:r("1J5t"),__esModule:!0}}},["XE6I"]);